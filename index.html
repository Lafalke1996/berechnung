<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>SmartKidsInvest - Professionelle Investmentberatung</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap');

        * {
            font-family: 'Quicksand', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 25%, #bae6fd 100%);
            color: #1e293b;
            min-height: 100vh;
        }
        
        .container-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        
        .header-main {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #e2e8f0 100%);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
        }
        
        .logo-placeholder {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: 800;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }
        
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            margin-left: 1rem;
            letter-spacing: -0.025em;
        }
        
        .logo-smart {
            color: #f59e0b;
        }
        
        .logo-kids {
            color: #f59e0b;
        }
        
        .logo-invest {
            color: #1e3a8a;
        }
        
        .logo-subtitle {
            font-size: 0.875rem;
            color: #475569;
            margin-top: 0.25rem;
            font-weight: 500;
            letter-spacing: 0.025em;
        }
        
        .nav-container {
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .nav-tabs {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .nav-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 140px;
            padding: 1rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            color: #64748b;
            font-weight: 600;
            font-size: 0.8rem;
            border-bottom: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
        }
        
        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .nav-label {
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.025em;
        }
        
        .nav-tab:hover {
            color: #fbbf24;
            transform: translateY(-2px);
        }
        
        .nav-tab:hover::before {
            opacity: 1;
        }
        
        .nav-tab.active {
            color: #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.15) 100%);
            border-bottom-color: #fbbf24;
            transform: translateY(-2px);
        }

        .nav-step {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            color: #475569;
            border-radius: 50%;
            font-size: 0.75rem;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .print-footer {
            display: none;
            background: #0e1e3a;
            color: #f8fafc;
            padding: 2rem 1.5rem;
        }

        .print-footer .footer-inner {
            max-width: 960px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 0.5rem;
        }

        .print-footer img {
            height: 48px;
            width: auto;
        }

        .print-footer .footer-text {
            font-size: 0.85rem;
            color: rgba(248, 250, 252, 0.9);
        }
        
        .nav-tab.active .nav-step {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1e293b;
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.4);
        }
        
        .page-content {
            padding: 3rem 0;
            min-height: calc(100vh - 200px);
        }
        
        .card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .card.card-compact {
            padding: 1.75rem 2rem;
            border-radius: 16px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1), 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .card.card-compact .card-title {
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .card.card-compact .summary-section {
            padding: 1.1rem 1.4rem;
            margin-bottom: 0;
            border-radius: 12px;
            box-shadow: none;
        }

        .card.card-compact .summary-item {
            padding: 0.55rem 0;
        }

        .card.card-compact .summary-label,
        .card.card-compact .summary-value {
            font-size: 0.85rem;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e2e8f0;
            letter-spacing: -0.025em;
        }
        
        .form-group {
            margin-bottom: 2rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.95rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.75rem;
            letter-spacing: 0.025em;
        }
        
        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
            color: #1e293b;
            font-weight: 500;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #fbbf24;
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.1);
            background: white;
            transform: translateY(-1px);
        }
        
        .form-select {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
            color: #1e293b;
            font-weight: 500;
            cursor: pointer;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #fbbf24;
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.1);
            background: white;
            transform: translateY(-1px);
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .checkbox-container:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: #fbbf24;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .checkbox-container.active {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
            border-color: #fbbf24;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.2);
        }
        
        .checkbox-input {
            width: 20px;
            height: 20px;
            accent-color: #fbbf24;
            cursor: pointer;
        }
        
        .checkbox-label {
            font-weight: 600;
            color: #1e293b;
            cursor: pointer;
            flex: 1;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1e293b;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.3);
            letter-spacing: 0.025em;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #475569;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
            backdrop-filter: blur(10px);
        }
        
        .btn-secondary:hover {
            background: white;
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .result-card {
            text-align: center;
            padding: 1.5rem 1rem;
            border-radius: 16px;
            border: 2px solid;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, currentColor 0%, currentColor 100%);
        }
        
        .result-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .result-icon {
            font-size: 3rem;
            margin-bottom: 1.25rem;
        }

        .result-card.primary {
            border-color: #1e40af;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%);
        }
        
        .result-card.success {
            border-color: #059669;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.05) 0%, rgba(16, 185, 129, 0.05) 100%);
        }
        
        .result-card.warning {
            border-color: #d97706;
            background: linear-gradient(135deg, rgba(217, 119, 6, 0.05) 0%, rgba(245, 158, 11, 0.05) 100%);
        }
        
        .result-card.neutral {
            border-color: #64748b;
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.05) 0%, rgba(148, 163, 184, 0.05) 100%);
        }
        
        .result-value {
            font-size: 1.75rem;
            font-weight: 900;
            margin: 1rem 0;
            letter-spacing: -0.025em;
            line-height: 1.1;
            word-break: break-word;
        }
        
        .result-card.primary .result-value {
            color: #1e40af;
        }
        
        .result-card.success .result-value {
            color: #059669;
        }
        
        .result-card.warning .result-value {
            color: #d97706;
        }
        
        .result-card.neutral .result-value {
            color: #64748b;
        }

        .summary-results-card .result-card {
            padding: 1.1rem 0.75rem;
            min-height: 150px;
        }

        .summary-results-card .result-icon {
            font-size: 2.3rem;
            margin-bottom: 0.85rem;
        }

        .summary-results-card h3 {
            font-size: 1.1rem !important;
            margin-bottom: 0.85rem !important;
        }

        .summary-results-card .result-value {
            font-size: 1.4rem;
        }

        .advantage-highlight {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 50%, #1e40af 100%);
            color: #ffffff;
            padding: 4rem;
            border-radius: 24px;
            text-align: center;
            margin: 3rem 0;
            box-shadow: 0 25px 50px rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .advantage-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
        }
        
        .advantage-box {
            background: rgba(255, 255, 255, 0.15);
            padding: 2.5rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .advantage-box:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(255, 255, 255, 0.2);
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                min-width: 120px;
                font-size: 0.75rem;
                padding: 0.75rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .logo-text {
                font-size: 1.5rem;
            }
            
            .result-value {
                font-size: 1.5rem;
            }
        }
        
        .hidden {
            display: none;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-4 {
            margin-bottom: 1rem;
        }
        
        .mb-6 {
            margin-bottom: 1.5rem;
        }
        
        .mb-8 {
            margin-bottom: 2rem;
        }
        
        .mt-4 {
            margin-top: 1rem;
        }
        
        .mt-6 {
            margin-top: 1.5rem;
        }
        
        .mt-8 {
            margin-top: 2rem;
        }
        
        .space-x-4 > * + * {
            margin-left: 1rem;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 1rem 0;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 4rem 3rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #e2e8f0 100%);
            border-radius: 24px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 50%, #1e40af 100%);
        }
        
        .page-header h1 {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 1rem;
            letter-spacing: -0.025em;
        }
        
        .page-header p {
            color: #475569;
            font-size: 0.95rem;
            font-weight: 500;
            letter-spacing: 0.025em;
        }
        
        .summary-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            border: 2px solid #e2e8f0;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        
        .summary-item:hover {
            background: rgba(251, 191, 36, 0.05);
            margin: 0 -1rem;
            padding: 1rem;
            border-radius: 8px;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            color: #475569;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .summary-value {
            font-weight: 700;
            color: #1e293b;
            font-size: 0.95rem;
        }
        
        .insurance-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .insurance-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #64748b 0%, #94a3b8 100%);
        }
        
        .insurance-header {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
            letter-spacing: -0.025em;
        }
        
        .recommendation-box {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.05) 0%, rgba(245, 158, 11, 0.05) 100%);
            border: 2px solid #fbbf24;
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .recommendation-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
        }
        
        .recommendation-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            letter-spacing: 0.025em;
        }
        
        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }

            #page-zusammenfassung, #page-zusammenfassung * {
                visibility: visible;
            }

            .print-footer,
            .print-footer * {
                visibility: visible;
            }

            #page-zusammenfassung {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding-bottom: 0;
                display: flex;
                flex-direction: column;
                min-height: 100vh;
            }
            
            .nav-container, .btn-primary, .btn-secondary {
                display: none !important;
            }
            
            .page-content {
                padding: 0;
                margin: 0;
            }
            
            .page-header {
                margin-bottom: 1rem;
                padding: 1rem;
                page-break-inside: avoid;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #e5e7eb;
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 1rem;
                padding: 1rem;
            }

            .card.card-compact {
                padding: 0.6rem 0.75rem;
            }

            .card.card-compact .summary-section {
                padding: 0.6rem 0.75rem;
            }

            .card.card-compact .summary-label,
            .card.card-compact .summary-value {
                font-size: 0.8rem;
            }
            
            .insurance-section {
                page-break-inside: avoid;
            }
            
            .grid-2, .grid-3, .grid-4 {
                page-break-inside: avoid;
            }
            
            .result-card {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 0.5rem;
                min-height: auto;
                padding: 1rem;
            }
            
            .result-value {
                font-size: 1.25rem;
            }
            
            canvas {
                max-height: 300px !important;
            }
            
            .container-main {
                max-width: 100%;
                padding: 0;
            }
            
            h1, h2, h3 {
                page-break-after: avoid;
            }
            
            .summary-section {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    

/* ---- Fondsportfolio: clean table ---- */
.pro-table{width:100%; border-collapse:collapse; background:#fff; border:1px solid #e5e7eb; border-radius:12px; overflow:hidden}
.pro-table thead th{background:#f8fafc; padding:.75rem 1rem; font-weight:700; font-size:.9rem; color:#0f172a; border-bottom:1px solid #e5e7eb; text-align:left}
.pro-table tbody td{padding:.5rem 1rem; border-bottom:1px solid #f1f5f9; vertical-align:middle}
.pro-table tbody tr:last-child td{border-bottom:0}
.pro-table td.num, .pro-table th.num{text-align:center}
.pro-table input{height:38px; padding:.5rem .75rem; border:1px solid #e5e7eb; border-radius:10px; background:#f9fafb; width:100%}
.pro-table tfoot td{background:#f9fafb; font-weight:700; padding:.75rem 1rem; border-top:1px solid #e5e7eb}
.summary-section.strong{border:2px solid #1e3a8a; background:linear-gradient(180deg,#f8fbff, #f0f7ff)}
.summary-section .summary-item{display:grid; grid-template-columns:1fr 180px}
.summary-section .summary-value{text-align:right; font-variant-numeric:tabular-nums}

/* --- UI Tweaks for Fondsportfolio (Seite 3) --- */
#fundTable td input[type="number"] { width: 7rem; padding: .25rem .5rem; height: 2.25rem; }
#fundTable td input[type="text"]   { width: 18rem; padding: .25rem .5rem; height: 2.25rem; }
#fundTable td { vertical-align: middle; }
#fundTable .icon-btn { height: 2.25rem; width: 2.25rem; }

/* Make numeric columns tighter */
#fundTable th.num, #fundTable td.num { white-space: nowrap; }

/* Center-align numeric inputs in fund table */
#fundTable td.num input[type="number"] { text-align: center; }

#fundTable .portfolioReturnCell { text-align: center; }
#fundTable .summary-label-cell { text-align: center; font-weight: 600; }
#fundTable .total-return-cell { display: flex; flex-direction: column; align-items: center; gap: 0.25rem; font-weight: 700; }
#fundTable .total-return-label { font-size: 0.85rem; color: #475569; }
#fundTable .total-return-value { font-variant-numeric: tabular-nums; }

        .portfolio-chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .chart-shell {
            position: relative;
            height: 320px;
        }

        .chart-shell canvas {
            position: absolute;
            inset: 0;
            width: 100% !important;
            height: 100% !important;
        }

        @media (max-width: 768px) {
            .chart-shell {
                height: 280px;
            }
            .portfolio-chart-grid {
                grid-template-columns: 1fr;
            }
        }

/* Smaller, subtler trash icon */
.icon-btn { height: 1.75rem; width: 1.75rem; display:inline-flex; align-items:center; justify-content:center; border-radius: .5rem; }
.icon-btn svg { width: 14px; height: 14px; opacity: .7; }
.icon-btn:hover svg { opacity: 1; }
/* Center-align numeric inputs */
#fundTable td.num input[type="number"] { text-align:center; }

/* Ensure Vorteile grid spans full width and cards can sit in columns */
#page-summary .card.w-full.max-w-none { max-width: none; }
.summary-advantages-card {
    overflow: hidden;
    padding: 1.75rem 2rem;
}

.summary-advantages-card h2 {
    margin-bottom: 1.25rem !important;
}

.summary-advantages-row {
    display: flex;
    gap: 1.25rem;
    overflow-x: auto;
    padding-bottom: 0.75rem;
    margin: 0 -0.5rem;
    scroll-snap-type: x proximity;
}

.summary-advantages-row .card {
    flex: 1 0 260px;
    scroll-snap-align: start;
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 10px 28px rgba(15, 23, 42, 0.08);
}

.summary-advantages-row .feature-row {
    padding: 0.35rem 0;
    font-size: 0.9rem;
}

.summary-advantages-row .feature-row svg {
    width: 16px;
    height: 16px;
}

.summary-advantages-row::-webkit-scrollbar {
    height: 8px;
}

    
.summary-advantages-row::-webkit-scrollbar-thumb {
    background: rgba(148, 163, 184, 0.35);
    border-radius: 9999px;
}

@media (max-width: 768px) {
    .summary-advantages-card {
        padding: 1.5rem;
    }

    .summary-advantages-row {
        margin: 0;
    }
}

@media (min-width: 1024px) {
    .summary-advantages-row {
        margin: 0;
        overflow-x: visible;
    }

    .summary-advantages-row .card {
        flex: 1 1 0;
    }
}

@media print {
    .summary-advantages-row {
        margin: 0;
        overflow: visible;
    }

    .summary-advantages-card {
        padding: 1rem 1.25rem !important;
    }

    .summary-advantages-row {
        gap: 0.75rem;
    }

    .summary-advantages-row .card {
        flex: 1 1 0;
        padding: 0.75rem 0.9rem;
        box-shadow: none;
        border: 1px solid #dbe1f1;
    }

    .summary-advantages-row .feature-row {
        font-size: 0.75rem;
        padding: 0.25rem 0;
    }

    .summary-advantages-row .feature-row svg {
        width: 14px;
        height: 14px;
    }
}
</style>
<!-- Professional redesign overrides (no HTML changes) -->
<style>
:root{
  --brand: #1e3a8a;           /* Deep brand blue */
  --brand-2: #0f52ba;         /* Accent blue */
  --brand-accent: #f59e0b;    /* Brand gold */
  --text: #0f172a;            /* Slate-900 */
  --muted: #475569;           /* Slate-600 */
  --bg: #f6f7f9;              /* Soft app background */
  --surface: #ffffff;         /* Card surface */
  --surface-2: #f9fafb;       /* Subtle surface */
  --border: #e5e7eb;          /* Card borders */
  --ring: rgba(31, 111, 235, 0.18);
  --shadow-sm: 0 1px 2px rgba(0,0,0,.04);
  --shadow-md: 0 8px 24px rgba(16, 24, 40, .06);
  --shadow-lg: 0 12px 32px rgba(16, 24, 40, .08);
  --radius: 16px;
}

/* ============ Global reset / typography ============ */
html{scroll-behavior:smooth}
*{font-feature-settings:"liga" 1,"calt" 1}
body{background:var(--bg)!important;color:var(--text);}
.container-main{max-width:1100px}

/* Headings */
h1,h2,h3{letter-spacing:-.01em;color:var(--text)}
h1{font-weight:800;font-size:clamp(1.6rem,1.2rem+1.2vw,2rem)}
h2{font-weight:700;font-size:1.125rem}
h3{font-weight:700;font-size:1rem}

/* Text smoothing */
body,button,input,select{ -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale }

/* Reduce the heavy gradients everywhere to a modern, clean UI */
.header-main,
.page-header,
.card,
.insurance-section,
.summary-section{background:var(--surface)!important;border:1px solid var(--border)!important;box-shadow:var(--shadow-md)!important}

/* Subtle page header with divider bar */
.page-header{border-radius:var(--radius);padding:2rem 2rem}
.page-header::before{background:linear-gradient(90deg,var(--brand),var(--brand-2))!important;height:3px}
.page-header p{color:var(--muted)!important;font-weight:500}

/* Header with compact brand treatment */
.header-main{backdrop-filter:saturate(120%) blur(8px);border:0;border-bottom:1px solid var(--border)!important;box-shadow:var(--shadow-sm)!important}
.logo-text{font-weight:900;letter-spacing:-.02em}
.logo-smart,.logo-kids{color:var(--brand-accent)!important}
.logo-invest{color:var(--brand)!important}
.logo-subtitle{color:var(--muted)!important}

/* Navigation tabs -> simplified underline tabs */
.nav-container{background:var(--surface)!important;border-bottom:1px solid var(--border)!important;box-shadow:var(--shadow-sm)!important}
.nav-tabs{gap:.25rem}
.nav-tab{min-width:unset;padding:.875rem 1.25rem;border-bottom:2px solid transparent;background:transparent!important;color:#64748b;box-shadow:none}
.nav-tab .nav-step{background:#eef2ff!important;color:var(--brand)!important;box-shadow:none}
.nav-tab:hover{color:var(--brand-accent)!important;transform:none}
.nav-tab.active{color:var(--brand)!important;border-bottom-color:var(--brand)!important;background:transparent}
.nav-tab.active .nav-step{background:var(--brand)!important;color:#fff!important}

/* Cards */
.card{border-radius:var(--radius)!important;padding:2rem!important}
.card::before{display:none}
.card-title{border-bottom:1px solid var(--border)!important;margin-bottom:1rem!important;padding-bottom:.75rem}

/* Forms */
.form-label{color:#0f172a!important}
.form-input,.form-select{background:var(--surface-2)!important;border:1px solid var(--border)!important;border-radius:12px!important}
.form-input:focus,.form-select:focus{outline:0;box-shadow:0 0 0 6px var(--ring)!important;border-color:transparent!important;transform:none}

/* Checkbox rows */
.checkbox-container{background:var(--surface-2)!important;border-color:var(--border)!important;box-shadow:var(--shadow-sm)}
.checkbox-container:hover{box-shadow:var(--shadow-md);transform:none}
.checkbox-container.active{background:#eef6ff!important;border-color:#cfe1ff!important;box-shadow:var(--shadow-md)}

/* Buttons – solid primary & neutral secondary */
.btn-primary{background:linear-gradient(0deg,var(--brand),var(--brand))!important;color:#fff!important;border:none!important;box-shadow:var(--shadow-md)!important}
.btn-primary:hover{transform:translateY(-1px);filter:saturate(110%);box-shadow:var(--shadow-lg)!important}
.btn-secondary{background:var(--surface)!important;color:var(--text)!important;border:1px solid var(--border)!important;box-shadow:var(--shadow-sm)!important}
.btn-secondary:hover{transform:translateY(-1px);box-shadow:var(--shadow-md)!important;border-color:#d1d5db!important}

/* Results */
.result-card{background:var(--surface)!important;border-color:var(--border)!important;box-shadow:var(--shadow-sm)!important}
.result-card::before{background:linear-gradient(90deg,var(--brand),var(--brand-2))!important;height:4px}
.result-card.primary .result-value{color:var(--brand)!important}
.result-card.success .result-value{color:#0f766e!important}
.result-card.warning .result-value{color:#b45309!important}
.result-card.neutral .result-value{color:#334155!important}

/* Comparison section – neutralize inline gradient tiles */
#page-berechnung .card > div[style*="background:"]{background:var(--surface-2)!important;border:1px solid var(--border)!important}
#page-berechnung .card > div h3{color:var(--text)!important}
#page-berechnung .card > div p{color:var(--muted)!important}

/* Advantage highlight section – cleaner hero */
.advantage-highlight{background:linear-gradient(180deg,#0f172a 0%,#111827 100%)!important;color:#fff;border:0;box-shadow:var(--shadow-lg)}
.advantage-highlight::before{background:linear-gradient(90deg,var(--brand-accent),#f59e0b)!important}
.advantage-box{background:rgba(255,255,255,.06)!important;border-color:rgba(255,255,255,.12)!important}

/* Feature list tweaks */
.feature-list li{border-bottom:1px dashed #edf2f7}
.feature-list strong{font-weight:700}

/* Insurance sections */
.insurance-section{border-radius:var(--radius);}
.insurance-section::before{background:linear-gradient(90deg,var(--brand),var(--brand-2))!important;height:3px}
.recommendation-box{background:#f8fafc!important;border:1px solid var(--border)!important;box-shadow:var(--shadow-sm)!important}
.recommendation-box::before{display:none}
.recommendation-title{color:var(--text)!important}

/* Grid spacing and responsiveness */
.grid-2,.grid-3,.grid-4{gap:1.25rem!important}
@media (max-width:768px){
  .card{padding:1.25rem!important}
  .nav-tab{padding:.75rem .875rem}
}

/* Page content spacing */
.page-content{padding:2rem 0}

/* Summary widgets */
.summary-section{border-radius:12px}
.summary-item{border-bottom:1px dashed #edf2f7}
.summary-item:hover{background:#f8fafc!important;margin:0;padding:1rem;border-radius:8px}
.summary-label{color:var(--muted)!important}
.summary-value{color:var(--text)!important}

/* Print polish */
@media print{
  body{background:#fff!important}
  .card,.page-header,.summary-section,.insurance-section{box-shadow:none!important;border:1px solid #dfe3e8!important}
  .result-card h3{font-size:1.1rem!important}
  .result-value{font-size:1rem!important}
}

/* Focus-visible for accessibility */
:focus-visible{outline:3px solid var(--ring);outline-offset:2px;border-radius:10px}

/* Subtle transitions */
button,.form-input,.form-select,.checkbox-container,.card,.nav-tab{transition:box-shadow .25s ease, transform .25s ease, border-color .2s ease}

</style>
<style>

/* --- Vergleichsblock: Unser besonderes Konzept --- */
.comparison-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1.25rem}
@media (max-width:900px){.comparison-grid{grid-template-columns:1fr}}
.pill{display:inline-block;padding:.35rem .6rem;border-radius:9999px;font-weight:800;letter-spacing:.01em}
.pill.spar{background:#7f1d1d;color:#fff}
.pill.depot{background:#7f1d1d;color:#fff}
.pill.ski{background:#065f46;color:#fff}
.feature-row{display:flex;align-items:center;gap:.6rem;padding:.4rem 0}
.feature-row svg{width:18px;height:18px;opacity:.95}
.icon-check{color:#16a34a}
.icon-x{color:#dc2626}
.card hr.thin{border:0;border-top:1px solid var(--border);margin:1rem 0}

</style>
<style id="extras-redesign">

/* Extras Redesign (Seite 4) */
.extras-wrap{margin-top:1.25rem}
.extras-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1.25rem}
@media (max-width:900px){.extras-grid{grid-template-columns:1fr}}

.card.extras-card{
  background:var(--surface,#fff);
  border:1px solid var(--border,#e5e7eb);
  box-shadow:var(--shadow-md,0 8px 24px rgba(16,24,40,.06));
  border-radius:var(--radius,16px);
  padding:2rem
}
.card.extras-card .card-title{
  border-bottom:1px solid var(--border,#e5e7eb);
  padding-bottom:.75rem;margin-bottom:1rem
}

.perk{
  position:relative;
  background:var(--surface,#fff);
  border:1px solid var(--border,#e5e7eb);
  border-radius:var(--radius,16px);
  box-shadow:var(--shadow-md,0 8px 24px rgba(16,24,40,.06));
  padding:1rem
}
.perk .icon{
  width:44px;height:44px;border-radius:9999px;
  display:grid;place-items:center;
  background:#eef2ff;color:var(--brand,#1e3a8a);font-size:22px
}
.perk h3{margin:.5rem 0 .25rem;font-weight:700;font-size:1rem}
.perk p{color:var(--muted,#475569);font-size:.95rem;line-height:1.4}
.badge-free{
  position:absolute;top:12px;right:12px;
  background:linear-gradient(90deg,var(--brand-accent,#f59e0b),#f6c453);
  color:#111827;border-radius:9999px;padding:.2rem .5rem;
  font-weight:800;font-size:.7rem;letter-spacing:.02em
}

</style>
<style>
@media print {
  .no-print { display: none !important; }
  .print-footer { display: none !important; }
  .print-footer.print-footer-inline {
    display: flex !important;
    position: relative !important;
    bottom: auto !important;
    left: auto !important;
    right: auto !important;
    width: 100%;
    box-sizing: border-box;
    padding: 2rem 1.5rem !important;
    margin-top: auto;
    background: #0e1e3a !important;
    color: #f8fafc !important;
    border-top: none;
    justify-content: center;
  }
  .print-footer.print-footer-inline .footer-inner {
    flex-direction: column;
  }
}
</style>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f8f9fa;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        
        .gold-gradient {
            background: linear-gradient(135deg, #d4af37 0%, #f0e6c0 50%, #d4af37 100%);
        }
        
        .gold-text {
            background: linear-gradient(135deg, #d4af37 0%, #f0e6c0 50%, #d4af37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .luxury-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.1);
            transition: all 0.3s ease;
        }
        
        .luxury-card:hover {
            box-shadow: 0 8px 30px 0 rgba(0, 0, 0, 0.1), 0 1px 3px 0 rgba(212, 175, 55, 0.2);
        }
        
        .luxury-input {
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            background-color: #f8fafc;
        }
        
        .luxury-input:focus {
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
            outline: none;
        }
        
        .luxury-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        .luxury-button {
            background: linear-gradient(135deg, #d4af37 0%, #f0e6c0 50%, #d4af37 100%);
            color: #0a2f5c;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(212, 175, 55, 0.25);
            border: none;
        }
        
        .luxury-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(212, 175, 55, 0.3);
        }
        
        .luxury-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(212, 175, 55, 0.2);
        }
        
        .luxury-button-secondary {
            background: transparent;
            color: #0a2f5c;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
            border: 1px solid #d4af37;
        }
        
        .luxury-button-secondary:hover {
            background-color: rgba(212, 175, 55, 0.1);
        }
        
        .progress-bar {
            height: 4px;
            background-color: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #d4af37 0%, #f0e6c0 100%);
            transition: width 0.5s ease;
        }
        
        .checkbox-gold {
            appearance: none;
            -webkit-appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 1px solid #d4af37;
            border-radius: 0.25rem;
            background-color: white;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .checkbox-gold:checked {
            background-color: #d4af37;
            border-color: #d4af37;
        }
        
        .checkbox-gold:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.75rem;
        }
        
        .checkbox-gold:focus {
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
            outline: none;
        }
        
        .radio-gold {
            appearance: none;
            -webkit-appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 1px solid #d4af37;
            border-radius: 50%;
            background-color: white;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .radio-gold:checked {
            border-color: #d4af37;
            border-width: 4px;
        }
        
        .radio-gold:focus {
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
            outline: none;
        }
        
        .page-transition {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .page-enter {
            opacity: 0;
            transform: translateX(20px);
        }
        
        .page-visible {
            opacity: 1;
            transform: translateX(0);
        }
        
        @media print {
            .no-print {
                display: none !important;
            }

            .print-break-inside-avoid {
                break-inside: avoid;
            }

            .print-break-before {
                break-before: page;
            }

            html {
                zoom: 0.9;
            }

            body {
                background-color: white;
                padding: 0;
                margin: 0;
                padding-bottom: 200px;
            }

            .container {
                max-width: 100% !important;
                width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            .luxury-card {
                box-shadow: none !important;
                border: 1px solid #e2e8f0 !important;
                break-inside: avoid;
                margin-bottom: 2rem !important;
            }
        }
    
@media print {
  .print-footer.print-footer-inline {
    padding: 1.5rem 2rem !important;
    background-color: #0e1e3a !important;
    color: #f8fafc !important;
    border-top: none;
  }
}


  body {
    font-family: 'Quicksand', sans-serif;
  }
  .font-quicksand {
    font-family: 'Quicksand', sans-serif;
  }
  .gold-text {
    color: #d4af37;
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<style id="gold-button-map">
/* Map existing buttons to your gold design (no HTML changes) */
.btn-primary{
  background: linear-gradient(135deg, #d4af37 0%, #f0e6c0 50%, #d4af37 100%) !important;
  color:#0a2f5c !important;
  font-weight:600 !important;
  box-shadow:0 4px 6px rgba(212,175,55,.25) !important;
  border:none !important;
}
.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 12px rgba(212,175,55,.3) !important;
}
.btn-primary:active{
  transform:translateY(0);
  box-shadow:0 2px 4px rgba(212,175,55,.2) !important;
}
.btn-secondary{
  background:transparent !important;
  color:#0a2f5c !important;
  font-weight:500 !important;
  border:1px solid #d4af37 !important;
}
.btn-secondary:hover{
  background-color:rgba(212,175,55,.1) !important;
}
</style>
<style id="gold-progress-anim">
.progress-bar{ position: relative; overflow: hidden; }
.progress-fill{
  background: linear-gradient(90deg, #d4af37 0%, #f0e6c0 50%, #d4af37 100%) !important;
  background-size: 200% 100%;
  animation: goldshine 2.5s linear infinite;
  height: 100%;
}
@keyframes goldshine{
  0%{ background-position: 0% 0; }
  100%{ background-position: 200% 0; }
}
</style>

<style id="summary-chart-fixes">
#page-zusammenfassung canvas#summaryChart { display:block; width:100% !important; }
#page-zusammenfassung .card div[style*="position: relative"] { width:100% !important; min-height:360px; }
</style>

</head>
<body class="bg-gray-50">
<header class="bg-gray-100 py-4 border-b border-gray-300 shadow-sm">
<div class="max-w-6xl mx-auto flex items-center justify-between px-4">
<div class="flex items-center space-x-4">
<img alt="SmartKidsInvest Logo" class="h-10 w-auto" src="smartkids-logo.png"/>
<h1 class="text-2xl font-bold font-quicksand">
<span class="text-[#d4af37] font-quicksand">SmartKids</span><span class="text-gray-800 font-quicksand">Invest</span>
</h1>
</div>
<p class="text-sm text-gray-600 font-quicksand">Exklusive Finanzberatung für Familien</p>
</div>
</header>
<div class="container mx-auto px-4 py-8 max-w-5xl">
<!-- Header -->
<!-- Progress Bar -->
<div class="mb-4 no-print">
<div class="flex justify-between text-sm text-gray-500 mb-2">
<span>Start</span>
<span>Abschluss</span>
</div>
<div class="progress-bar">
<div class="progress-fill" id="progress-fill" style="width: 0%"></div>
</div>
</div>
</div>
<!-- Main Content -->
<main class="container-main">
<!-- Page 1: Kundendaten -->
<div class="page-content" id="page-kundendaten">
<div class="page-header">
<h1>Willkommen bei SmartKidsInvest</h1>
<p>Der beste Start in die finanzielle Zukunft Ihres Kindes</p>
</div>
<div class="grid-2">
<div class="card">
<h2 class="card-title">Ihre Familie</h2>
<div class="form-group">
<label class="form-label">Ihr Name</label>
<input class="form-input" id="customerName" placeholder="Max und Maria Mustermann" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Beratungsdatum</label>
<input class="form-input" id="consultationDate" type="date"/>
</div>
</div>
<div class="card">
<h2 class="card-title">Ihr Berater</h2>
<div class="form-group">
<label class="form-label">Name</label>
<input class="form-input" id="advisorName" placeholder="Sarah Schmidt" type="text"/>
</div>
<div class="form-group">
<label class="form-label">E-Mail</label>
<input class="form-input" id="advisorEmail" placeholder="sarah.schmidt@smartkidsinvest.de" type="email"/>
</div>
<div class="form-group">
<label class="form-label">Telefon</label>
<input class="form-input" id="advisorPhone" placeholder="+49 123 456 789" type="tel"/>
</div>
</div>
</div>
<div class="text-center mt-8">
<button class="btn-primary" onclick="showPage('berechnung')">
                    Weiter zur Berechnung
                    <svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path>
</svg>
</button>
</div>
</div>
<!-- Page 2: Berechnung & Ergebnisse -->
<div class="page-content" id="page-berechnung">
<div class="page-header">
<h1>Ihre Anlagestrategie</h1>
<p>Gemeinsam finden wir die perfekte Lösung für Ihr Kind</p>
</div>
<div class="grid-2">
<div class="card">
<h2 class="card-title">Ihr Kind</h2>
<div class="form-group">
<label class="form-label">Name Ihres Kindes</label>
<input class="form-input" id="childName" placeholder="Anna Mustermann" type="text"/>
</div>
<div class="grid-2">
<div class="form-group">
<label class="form-label">Aktuelles Alter</label>
<input class="form-input" id="childAge" max="18" min="0" onchange="updateLivePreview()" placeholder="5" type="number" value="0"/>
</div>
<div class="form-group">
<label class="form-label">Endalter</label>
<input class="form-input" id="endAge" max="80" min="18" onchange="updateLivePreview()" placeholder="67" type="number" value="67"/>
</div>
</div>
<div class="form-group">
<label class="form-label">Monatlicher Sparbeitrag (€)</label>
<input class="form-input" id="monthlyAmount" min="25" onchange="updateLivePreview()" placeholder="100" step="25" type="number" value="100"/>
</div>
<div class="form-group">
<label class="form-label">Startkapital (€)</label>
<input class="form-input" id="startCapital" min="0" onchange="updateLivePreview()" placeholder="1000" step="100" type="number" value="1000"/>
</div>
<div class="form-group">
<label class="form-label">Effektivkosten SmartKidsInvest (% p.a.)</label>
<input class="form-input" id="effectiveCosts" max="5" min="0" onchange="updateLivePreview()" placeholder="0.6" step="0.1" type="number" value="0.6"/>
</div>
<div class="form-group">
<label class="form-label">Gesellschaft</label>
<select class="form-select" id="company" onchange="updateLivePreview()">
<option value="baloise">Baloise Lebensversicherung</option>
<option value="alte-leipziger">Alte-Leipziger Lebensversicherung</option>
<option value="nuernberger">Nürnberger Lebensversicherung</option>
<option value="lv1871">LV 1871 Lebensversicherung</option>
<option value="allianz">Allianz Lebensversicherung</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Endergebnis SmartKidsInvest (€)</label>
<input class="form-input" id="smartKidsTarget" onchange="formatTargetAmount(); updateLivePreview()" placeholder="250.000" type="text" value="250.000"/>
<p style="font-size: 0.75rem; color: #6b7280; margin-top: 0.5rem;">Zielwert für SmartKidsInvest-Konzept</p>
</div>
</div>
<div>
<div class="card">
<h2 class="card-title">Kostenübersicht</h2>
<div class="summary-section">
<div class="summary-item">
<span class="summary-label">Laufzeit:</span>
<span class="summary-value" id="previewDuration">-</span>
</div>
<div class="summary-item">
<span class="summary-label">Beitragssumme:</span>
<span class="summary-value" id="previewTotal">-</span>
</div>
<div class="summary-item">
<span class="summary-label">Abschlusskosten:</span>
<span class="summary-value" id="previewClosingCosts">-</span>
</div>
<div class="summary-item">
<span class="summary-label">Effektivkosten:</span>
<span class="summary-value" id="previewEffectiveCosts">-</span>
</div>
<div class="summary-item">
<span class="summary-label">Guthaben:</span>
<span class="summary-value" id="previewSmartKidsTarget">-</span>
</div>
</div>
</div>
<div class="card">
<h2 class="card-title">Produktvergleich</h2>
<div style="margin-bottom: 1rem; padding: 1.5rem; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 8px; border: 2px solid #3b82f6;">
<h3 style="font-weight: 700; color: #1e40af; margin-bottom: 0.75rem; font-size: 1rem; display: flex; align-items: center; gap: 0.75rem;">
<img alt="SmartKidsInvest" src="smartkids-logo.png" style="height:48px;"/>
                                SmartKidsInvest
                            </h3>
<p style="font-size: 0.875rem; color: #374151; margin: 0.25rem 0; font-weight: 500;">Zinssatz: 7,0% p.a.</p>
<p style="font-size: 0.875rem; color: #374151; margin: 0.25rem 0; font-weight: 500;">Effektivkosten: <span id="displayEffectiveCosts">0,6%</span> p.a.</p>
<p style="font-size: 0.875rem; color: #374151; margin: 0.25rem 0; font-weight: 500;">Abschlusskosten: 2,5% auf Beitragssumme</p>
</div>
<div style="margin-bottom: 1rem; padding: 1.5rem; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 8px; border: 2px solid #10b981;">
<h3 style="font-weight: 700; color: #059669; margin-bottom: 0.75rem; font-size: 1rem; display: flex; align-items: center; gap: 0.75rem;">
<div style="font-size: 2rem;">🏦</div>
                                Sparbuch
                            </h3>
<p style="font-size: 0.875rem; color: #374151; margin: 0.25rem 0; font-weight: 500;">Zinssatz: 0,5% p.a.</p>
<p style="font-size: 0.875rem; color: #374151; margin: 0.25rem 0; font-weight: 500;">Kosten: Keine</p>
</div>
<div style="padding: 1.5rem; background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border-radius: 8px; border: 2px solid #f59e0b;">
<h3 style="font-weight: 700; color: #d97706; margin-bottom: 0.75rem; font-size: 1rem; display: flex; align-items: center; gap: 0.75rem;">
<div style="font-size: 2rem;">🏠</div>
                                Bausparvertrag
                            </h3>
<p style="font-size: 0.875rem; color: #374151; margin: 0.25rem 0; font-weight: 500;">Zinssatz: 1,0% p.a.</p>
<p style="font-size: 0.875rem; color: #374151; margin: 0.25rem 0; font-weight: 500;">Abschlussgebühr: 1,0% der Bausparsumme</p>
</div>
</div>
</div>
</div>
<!-- Results Section (initially hidden) -->
<div class="hidden mt-8" id="resultsSection">
<div class="page-header">
<h1>Ihre Ergebnisse</h1>
<p>📊 So entwickelt sich das Vermögen Ihres Kindes bis zum <span id="resultEndAge">67</span>. Lebensjahr</p>
</div>
<div class="grid-4 mb-8">
<div class="result-card neutral">
<h3 style="font-weight: 700; margin-bottom: 1rem; font-size: 1rem;">Ihre Einzahlungen</h3>
<div class="result-value" id="resultContributions">-</div>
<p style="font-size: 0.875rem; color: #6b7280; font-weight: 600;">Ohne Zinsen</p>
</div>
<div class="result-card primary">
<h3 style="font-weight: 700; margin-bottom: 1rem; font-size: 1rem;">SmartKidsInvest</h3>
<div class="result-value" id="resultSmartKids">-</div>
<p id="resultSmartKidsReturn" style="font-size: 0.875rem; color: #1e40af; font-weight: 700;">-</p>
</div>
<div class="result-card success">
<h3 style="font-weight: 700; margin-bottom: 1rem; font-size: 1rem;">Sparbuch</h3>
<div class="result-value" id="resultSavings">-</div>
<p id="resultSavingsReturn" style="font-size: 0.875rem; color: #059669; font-weight: 700;">-</p>
</div>
<div class="result-card warning">
<h3 style="font-weight: 700; margin-bottom: 1rem; font-size: 1rem;">Bausparvertrag</h3>
<div class="result-value" id="resultBuilding">-</div>
<p id="resultBuildingReturn" style="font-size: 0.875rem; color: #d97706; font-weight: 700;">-</p>
</div>
</div>
<div class="card">
<h2 class="card-title">Wertentwicklung im Zeitverlauf</h2>
<div style="position: relative; height: 400px; width: 100%;">
<canvas id="comparisonChart"></canvas>
</div>
</div>
</div>
<div class="text-center mt-8 space-x-4">
<button class="btn-secondary" onclick="showPage('kundendaten')">
<svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"></path>
</svg>
                    Zurück
                </button>
<button class="btn-primary" id="calculateBtn" onclick="calculateAndShowResults()">
                    Jetzt berechnen
                    <svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"></path>
</svg>
</button>
<button class="btn-secondary hidden" id="recalculateBtn" onclick="calculateAndShowResults()">
<svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path>
</svg>
                    Neu berechnen
                </button>
<button class="btn-primary hidden" id="nextToVorteileBtn" onclick="showPage('fondsportfolio')">
                    Weiter
                    <svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path>
</svg>
</button>
</div>
</div>
<!-- Page 3: Company Information -->
<!-- Page 3: Fondsportfolio -->
<div class="page-content hidden" id="page-fondsportfolio">
<div class="page-header">
<h1>Fondsportfolio</h1>
<p>Dein individuelles Fonds-Portfolio bei SmartKidsInvest</p>
</div>
<div class="card">
<div class="flex items-center justify-between mb-4">
<h2 class="card-title" style="margin-bottom:0">Fondsübersicht</h2>
<div>
<button class="btn-primary" id="addFundRowBtn">Fonds hinzufügen</button>
<button class="btn-secondary" id="clearFundsBtn" style="margin-left:.5rem">Löschen</button>
</div>
</div>
<div class="overflow-x-auto">
<table class="pro-table" id="fundTable">
<thead>
<tr>
<th>Fondsname</th>
<th class="num">Anteil (%)</th>
<th class="num">Rendite 5J (%)</th>
<th class="num">Rendite Portfolio (%)</th>
<th class="num"></th>
</tr>
</thead>
<tbody id="fundTableBody"></tbody>
<tfoot>
<tr>
<td class="summary-label-cell">Summen:</td>
<td class="num" id="sumWeightsCell">0,00 %</td>
<td class="num"></td>
<td class="num total-return-cell"><span class="total-return-label">Gesamtrendite</span><span class="total-return-value" id="sumPortfolioCell">0,00 %</span></td>
<td></td>
</tr>
</tfoot>
</table>
</div>
</div>
<div class="card">
<h2 class="card-title">Zusammenfassung</h2>
<div class="summary-section strong">
<div class="summary-item">
<span class="summary-label">Gesamtrendite</span>
<span class="summary-value" id="sumPortfolioReturn">0,00 %</span>
</div>
<div class="summary-item">
<span class="summary-label">Effektivkosten</span>
<span class="summary-value" id="effectiveCostsDisplay">0,60 %</span>
</div>
<div class="summary-item">
<span class="summary-label">Rendite nach Kosten</span>
<span class="summary-value" id="netReturnDisplay">0,00 %</span>
</div>
</div>
</div>
<div class="portfolio-chart-grid">
<div class="card">
<h2 class="card-title">Gesamtübersicht</h2>
<div class="chart-shell"><canvas id="chartSummaryBar"></canvas></div>
</div>
<div class="card">
<h2 class="card-title">Anteilsverteilung</h2>
<div class="chart-shell"><canvas id="chartAllocationPie"></canvas></div>
</div>
</div>
<div class="text-center mt-8 space-x-4">
<button class="btn-secondary" onclick="showPage('berechnung')">Zurück</button>
<button class="btn-primary" onclick="showPage('gesellschaft')">Weiter</button>
</div>
</div>
<div class="page-content hidden" id="page-gesellschaft">
<div class="page-header">
<h1 id="companyTitle">Ihre gewählte Gesellschaft</h1>
<p id="companySubtitle">Warum wir diese Gesellschaft empfehlen</p>
</div>
<!-- Baloise Information -->
<div id="baloiseInfo">
<div class="card">
<div class="grid-2 mb-6">
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum Baloise?</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🏆</div>
<div>
<strong>150+ Jahre Erfahrung</strong><br/>
<span style="color: #6b7280;">Seit 1863 ein verlässlicher Partner für Generationen</span>
</div>
</li>
<li>
<div class="feature-icon">💪</div>
<div>
<strong>Finanzstärke AAA</strong><br/>
<span style="color: #6b7280;">Höchste Bonitätsbewertung für maximale Sicherheit</span>
</div>
</li>
<li>
<div class="feature-icon">🌍</div>
<div>
<strong>Europaweit tätig</strong><br/>
<span style="color: #6b7280;">Starke Präsenz in Deutschland, Schweiz, Belgien und Luxemburg</span>
</div>
</li>
<li>
<div class="feature-icon">📈</div>
<div>
<strong>Überdurchschnittliche Überschüsse</strong><br/>
<span style="color: #6b7280;">Kontinuierlich hohe Gewinnbeteiligung für Kunden</span>
</div>
</li>
</ul>
</div>
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🎯</div>
<div>
<strong>Flexible Fondsauswahl</strong><br/>
<span style="color: #6b7280;">Über 100 Fonds zur individuellen Gestaltung</span>
</div>
</li>
<li>
<div class="feature-icon">🔄</div>
<div>
<strong>Kostenfreie Umschichtungen</strong><br/>
<span style="color: #6b7280;">Unbegrenzt und ohne zusätzliche Gebühren</span>
</div>
</li>
<li>
<div class="feature-icon">🛡️</div>
<div>
<strong>Garantierte Beitragsrückgewähr</strong><br/>
<span style="color: #6b7280;">100% Ihrer Einzahlungen sind garantiert</span>
</div>
</li>
<li>
<div class="feature-icon">⚡</div>
<div>
<strong>Schnelle Auszahlung</strong><br/>
<span style="color: #6b7280;">Unkomplizierte Abwicklung bei Fälligkeit</span>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<!-- Alte Leipziger Information -->
<div id="alteLeipzigerInfo">
<div class="card">
<div class="grid-2 mb-6">
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum Alte Leipziger?</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🏆</div>
<div>
<strong>200+ Jahre Tradition</strong><br/>
<span style="color: #6b7280;">Seit 1819 Deutschlands ältester Lebensversicherer</span>
</div>
</li>
<li>
<div class="feature-icon">💎</div>
<div>
<strong>Ausgezeichnete Ratings</strong><br/>
<span style="color: #6b7280;">A+ Rating von Standard &amp; Poor's für Stabilität</span>
</div>
</li>
<li>
<div class="feature-icon">🎖️</div>
<div>
<strong>Testsieger-Qualität</strong><br/>
<span style="color: #6b7280;">Regelmäßige Auszeichnungen von Stiftung Warentest</span>
</div>
</li>
<li>
<div class="feature-icon">📊</div>
<div>
<strong>Hohe Überschussbeteiligung</strong><br/>
<span style="color: #6b7280;">Überdurchschnittliche Gewinnausschüttung an Kunden</span>
</div>
</li>
</ul>
</div>
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🌟</div>
<div>
<strong>AL_best Fonds</strong><br/>
<span style="color: #6b7280;">Hauseigene Premiumfonds mit Top-Performance</span>
</div>
</li>
<li>
<div class="feature-icon">🔒</div>
<div>
<strong>Beitragsgarantie</strong><br/>
<span style="color: #6b7280;">Ihre Einzahlungen sind zu 100% geschützt</span>
</div>
</li>
<li>
<div class="feature-icon">🎯</div>
<div>
<strong>Flexible Strategien</strong><br/>
<span style="color: #6b7280;">Von konservativ bis chancenorientiert</span>
</div>
</li>
<li>
<div class="feature-icon">👨‍💼</div>
<div>
<strong>Persönlicher Service</strong><br/>
<span style="color: #6b7280;">Direkter Ansprechpartner für alle Fragen</span>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<!-- Nürnberger Information -->
<div id="nuernbergerInfo">
<div class="card">
<div class="grid-2 mb-6">
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum Nürnberger?</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🏆</div>
<div>
<strong>100+ Jahre Erfahrung</strong><br/>
<span style="color: #6b7280;">Seit 1884 ein starker Partner für Familien</span>
</div>
</li>
<li>
<div class="feature-icon">💪</div>
<div>
<strong>Solide Finanzstärke</strong><br/>
<span style="color: #6b7280;">A- Rating und stabile Kapitalausstattung</span>
</div>
</li>
<li>
<div class="feature-icon">🎯</div>
<div>
<strong>Spezialist für Altersvorsorge</strong><br/>
<span style="color: #6b7280;">Fokus auf langfristige Vermögensbildung</span>
</div>
</li>
<li>
<div class="feature-icon">📈</div>
<div>
<strong>Attraktive Überschüsse</strong><br/>
<span style="color: #6b7280;">Konstant gute Gewinnbeteiligung für Kunden</span>
</div>
</li>
</ul>
</div>
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🎨</div>
<div>
<strong>Breite Fondspalette</strong><br/>
<span style="color: #6b7280;">Über 80 Fonds für jede Anlagestrategie</span>
</div>
</li>
<li>
<div class="feature-icon">🔄</div>
<div>
<strong>Flexible Umschichtungen</strong><br/>
<span style="color: #6b7280;">Kostenfreie Anpassung der Anlagestrategie</span>
</div>
</li>
<li>
<div class="feature-icon">🛡️</div>
<div>
<strong>Beitragserhalt garantiert</strong><br/>
<span style="color: #6b7280;">Mindestens Ihre Einzahlungen sind sicher</span>
</div>
</li>
<li>
<div class="feature-icon">🏠</div>
<div>
<strong>Regionale Nähe</strong><br/>
<span style="color: #6b7280;">Deutschlandweites Servicenetz</span>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<!-- LV 1871 Information -->
<div id="lv1871Info">
<div class="card">
<div class="grid-2 mb-6">
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum LV 1871?</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🏆</div>
<div>
<strong>150+ Jahre Tradition</strong><br/>
<span style="color: #6b7280;">Seit 1871 ein verlässlicher Partner für Generationen</span>
</div>
</li>
<li>
<div class="feature-icon">💪</div>
<div>
<strong>Starke Finanzstärke</strong><br/>
<span style="color: #6b7280;">A+ Rating und solide Kapitalausstattung</span>
</div>
</li>
<li>
<div class="feature-icon">🚀</div>
<div>
<strong>Innovationsführer</strong><br/>
<span style="color: #6b7280;">Moderne digitale Lösungen und Services</span>
</div>
</li>
<li>
<div class="feature-icon">📈</div>
<div>
<strong>Überdurchschnittliche Renditen</strong><br/>
<span style="color: #6b7280;">Konstant hohe Überschussbeteiligung</span>
</div>
</li>
</ul>
</div>
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🎯</div>
<div>
<strong>Maxxellence Invest</strong><br/>
<span style="color: #6b7280;">Innovative Fondspolice mit Top-Performance</span>
</div>
</li>
<li>
<div class="feature-icon">🔄</div>
<div>
<strong>Kostenfreie Switches</strong><br/>
<span style="color: #6b7280;">Unbegrenzte Umschichtungen ohne Gebühren</span>
</div>
</li>
<li>
<div class="feature-icon">🛡️</div>
<div>
<strong>Beitragsgarantie</strong><br/>
<span style="color: #6b7280;">100% Schutz Ihrer eingezahlten Beiträge</span>
</div>
</li>
<li>
<div class="feature-icon">📱</div>
<div>
<strong>Digitaler Service</strong><br/>
<span style="color: #6b7280;">Online-Portal für einfache Verwaltung</span>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<!-- Allianz Information -->
<div id="allianzInfo">
<div class="card">
<div class="grid-2 mb-6">
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum Allianz?</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🏆</div>
<div>
<strong>130+ Jahre Erfahrung</strong><br/>
<span style="color: #6b7280;">Seit 1890 Deutschlands größter Lebensversicherer</span>
</div>
</li>
<li>
<div class="feature-icon">💪</div>
<div>
<strong>Marktführer Deutschland</strong><br/>
<span style="color: #6b7280;">AA Rating und höchste Finanzstärke</span>
</div>
</li>
<li>
<div class="feature-icon">🌍</div>
<div>
<strong>Weltweite Präsenz</strong><br/>
<span style="color: #6b7280;">Globaler Versicherungskonzern mit lokaler Expertise</span>
</div>
</li>
<li>
<div class="feature-icon">📈</div>
<div>
<strong>Konstante Überschüsse</strong><br/>
<span style="color: #6b7280;">Verlässlich hohe Gewinnbeteiligung für Kunden</span>
</div>
</li>
</ul>
</div>
<div>
<h3 style="font-size: 1.125rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h3>
<ul class="feature-list">
<li>
<div class="feature-icon">🎯</div>
<div>
<strong>InvestFlex Konzept</strong><br/>
<span style="color: #6b7280;">Flexible Fondspolice mit erstklassiger Performance</span>
</div>
</li>
<li>
<div class="feature-icon">🔄</div>
<div>
<strong>Kostenfreie Umschichtungen</strong><br/>
<span style="color: #6b7280;">Beliebig viele Switches ohne zusätzliche Kosten</span>
</div>
</li>
<li>
<div class="feature-icon">🛡️</div>
<div>
<strong>Beitragsgarantie</strong><br/>
<span style="color: #6b7280;">Vollständiger Schutz aller eingezahlten Beiträge</span>
</div>
</li>
<li>
<div class="feature-icon">🏆</div>
<div>
<strong>Ausgezeichneter Service</strong><br/>
<span style="color: #6b7280;">Mehrfach prämierte Kundenbetreuung</span>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="text-center mt-8 space-x-4">
<button class="btn-secondary" onclick="showPage('berechnung')">
<svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"></path>
</svg>
                    Zurück
                </button>
<button class="btn-primary" onclick="showPage('vorteile')">
                    Weiter
                    <svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path>
</svg>
</button>
</div>
</div>
<!-- Page 4: Vorteile -->
<div class="page-content" id="page-vorteile">
<!-- Seite 4: nur kostenlose Extras (neues Design) -->
<div class="page-header">
<h1>Warum SmartKidsInvest?</h1>
<p>⭐ Die beste Wahl für junge Eltern wie Sie</p>
</div>
<div class="comparison-grid mb-8">
<!-- Sparbuch -->
<div class="card">
<div class="card-title"><span class="pill spar">Sparbuch</span></div>
<div class="feature-rows">
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Flexibilität</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Hohe Rendite</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Steuerfreier Strategiewechsel</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Lebenslange Konditionssicherung</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Kontrolle der Eltern mit 18</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Steuerfreie Auszahlung</div></div>
</div>
<hr class="thin"/>
</div>
<!-- Depot -->
<div class="card">
<div class="card-title"><span class="pill depot">Depot</span></div>
<div class="feature-rows">
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Flexibilität</div></div>
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Rendite</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Steuerfreier Strategiewechsel</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Lebenslange Konditionssicherung</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Kontrolle der Eltern mit 18</div></div>
<div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Steuerfreie Auszahlung</div></div>
</div>
<hr class="thin"/>
</div>
<!-- SmartKidsInvest Konzept -->
<div class="card">
<div class="card-title"><span class="pill ski">SmartKidsInvest Konzept</span></div>
<div class="feature-rows">
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Flexibilität</div></div>
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Rendite</div></div>
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Steuerfreier Strategiewechsel</div></div>
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Lebenslange Konditionssicherung</div></div>
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Kontrolle der Eltern mit 18</div></div>
<div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Steuerfreie Auszahlung</div></div>
</div>
<hr class="thin"/>
</div>
</div>
<div class="extras-wrap">
<div class="card extras-card">
<div class="card-title" style="display:flex;align-items:center;gap:.5rem;">
<span>🎁</span><span>Kostenlose Extras</span>
</div>
<div class="extras-grid">
<div class="perk">
<span class="badge-free">kostenlos</span>
<div class="icon">🛡️</div>
<h3>100% sichere Einzahlungen</h3>
<p>Ihre Beiträge sind durch gesetzliche Sicherungssysteme vollständig geschützt.</p>
</div>
<div class="perk">
<span class="badge-free">kostenlos</span>
<div class="icon">🚫</div>
<h3>Kostenfreie BU-Option</h3>
<p>Berufsunfähigkeitsschutz für Ihr Kind ohne zusätzliche Kosten integrierbar.</p>
</div>
<div class="perk">
<span class="badge-free">kostenlos</span>
<div class="icon">👨‍💼</div>
<h3>Kostenlose jährliche Beratung</h3>
<p>Regelmäßige, kostenfreie Beratungstermine mit unseren Finanzexperten.</p>
</div>
</div>
</div>
</div>
<div class="text-center mt-8 space-x-4">
<button class="btn-secondary" onclick="showPage('gesellschaft')">
<svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"></path>
</svg>
                    Zurück
                </button>
<button class="btn-primary" onclick="showPage('zusammenfassung')">
                    Weiter
                    <svg fill="currentColor" height="16" viewbox="0 0 24 24" width="16">
<path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path>
</svg>
</button>
</div>
</div><!-- Page 5: Zusatzabsicherungen -->

<!-- Page 6: Zusammenfassung -->
<div class="page-content" id="page-zusammenfassung">
<div class="page-header">
<h1>Ihre Beratungszusammenfassung</h1>
<p>📋 Alles auf einen Blick für Ihre Unterlagen</p>
</div>
<div class="grid-2 mb-6">
<div class="card card-compact">
<h2 class="card-title">Beratungsdetails</h2>
<div class="summary-section">
<div class="summary-item">
<span class="summary-label">👤 Familie:</span>
<span class="summary-value" id="summaryCustomer">-</span>
</div>
<div class="summary-item">
<span class="summary-label">👶 Kind:</span>
<span class="summary-value" id="summaryChild">-</span>
</div>
<div class="summary-item">
<span class="summary-label">👨‍💼 Berater:</span>
<span class="summary-value" id="summaryAdvisor">-</span>
</div>
<div class="summary-item">
<span class="summary-label">📅 Datum:</span>
<span class="summary-value" id="summaryDate">-</span>
</div>
</div>
</div>
<div class="card card-compact">
<h2 class="card-title">Anlageparameter</h2>
<div class="summary-section">
<div class="summary-item">
<span class="summary-label">🏦 Startkapital:</span>
<span class="summary-value" id="summaryStartCapital">-</span>
</div>
<div class="summary-item">
<span class="summary-label">💳 Monatlich:</span>
<span class="summary-value" id="summaryMonthly">-</span>
</div>
<div class="summary-item">
<span class="summary-label">⏱️ Laufzeit:</span>
<span class="summary-value" id="summaryDuration">-</span>
</div>
<div class="summary-item">
<span class="summary-label">🎯 Guthaben nach Kosten:</span>
<span class="summary-value" id="summarySmartKidsTarget">-</span>
</div>
<div class="summary-item">
<span class="summary-label">📈 Erwartete Rendite:</span>
<span class="summary-value" id="summaryReturn">-</span>
</div>
<div class="summary-item">
<span class="summary-label">💸 Effektivkosten:</span>
<span class="summary-value" id="summaryEffectiveCosts">-</span>
</div>
<div class="summary-item">
<span class="summary-label">🧾 Abschlusskosten:</span>
<span class="summary-value" id="summaryClosingCosts">-</span>
</div>
</div>
</div>
</div>
<div class="card summary-advantages-card mb-6">
    <h2 class="card-title">Warum SmartKidsInvest?</h2>
    <div class="summary-advantages-row">
        <div class="card">
            <div class="card-title"><span class="pill spar">Sparbuch</span></div>
            <div class="feature-rows">
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Flexibilität</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Hohe Rendite</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Steuerfreier Strategiewechsel</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Lebenslange Konditionssicherung</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Kontrolle der Eltern mit 18</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Steuerfreie Auszahlung</div></div>
            </div>
            <hr class="thin"/>
        </div>
        <div class="card">
            <div class="card-title"><span class="pill depot">Depot</span></div>
            <div class="feature-rows">
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Flexibilität</div></div>
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Rendite</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Steuerfreier Strategiewechsel</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Lebenslange Konditionssicherung</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Kontrolle der Eltern mit 18</div></div>
                <div class="feature-row"><svg class="icon-x" fill="currentColor" viewbox="0 0 24 24"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.41 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.59 16.89 4.29z"></path></svg><div>Steuerfreie Auszahlung</div></div>
            </div>
            <hr class="thin"/>
        </div>
        <div class="card">
            <div class="card-title"><span class="pill ski">SmartKidsInvest Konzept</span></div>
            <div class="feature-rows">
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Flexibilität</div></div>
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Hohe Rendite</div></div>
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Steuerfreier Strategiewechsel</div></div>
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Lebenslange Konditionssicherung</div></div>
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Kontrolle der Eltern mit 18</div></div>
                <div class="feature-row"><svg class="icon-check" fill="currentColor" viewbox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg><div>Steuerfreie Auszahlung</div></div>
            </div>
            <hr class="thin"/>
        </div>
    </div>
</div>
<div class="card mb-6 summary-results-card">
<h2 class="card-title">Berechnungsergebnisse</h2>
<div class="grid-4 mb-3">
<div class="result-card neutral">
<div aria-hidden="true" class="result-icon">💰</div>
<h3 style="font-weight: 800;">Ihre Einzahlungen</h3>
<div class="result-value" id="summaryContributions">-</div>
<p style="font-size: 0.95rem; color: #6b7280; font-weight: 600;">Ohne Zinsen</p>
</div>
<div class="result-card primary">
<img alt="SmartKidsInvest" src="smartkids-logo.png" style="height:60px; margin: 0 auto 1rem auto; display:block;"/>
<h3 style="font-weight: 800;">SmartKidsInvest</h3>
<div class="result-value" id="summarySmartKids">-</div>
<p id="smartKidsReturn" style="font-size: 1rem; color: #1e3a8a; font-weight: 700;">-</p>
</div>
<div class="result-card success">
<div aria-hidden="true" class="result-icon">🏦</div>
<h3 style="font-weight: 800;">Sparbuch</h3>
<div class="result-value" id="summarySavings">-</div>
<p id="savingsReturn" style="font-size: 1rem; color: #059669; font-weight: 700;">-</p>
</div>
<div class="result-card warning">
<div aria-hidden="true" class="result-icon">🏠</div>
<h3 style="font-weight: 800;">Bausparvertrag</h3>
<div class="result-value" id="summaryBuilding">-</div>
<p id="buildingReturn" style="font-size: 1rem; color: #d97706; font-weight: 700;">-</p>
</div>
</div>
</div>
<div class="card mb-6">
    <h2 class="card-title">Wertentwicklung im Zeitverlauf</h2>
    <div style="position: relative; height: 340px; width: 100%;">
        <canvas id="summaryChart"></canvas>
    </div>
</div>
<div class="card mb-6">
<h2 class="card-title">Ihre gewählte Gesellschaft</h2>
<div id="summaryCompanyInfo" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
<!-- Company info will be dynamically inserted here -->
</div>
</div>
<div class="card mb-6" id="summaryFundsCard">
<h2 class="card-title">Fondsportfolio</h2>
<div class="summary-section">
<div style="overflow-x:auto">
<table class="pro-table" id="summaryFundTable">
<thead>
<tr>
<th>Fondsname</th>
<th class="num">Anteil (%)</th>
<th class="num">Rendite 5J (%)</th>
<th class="num">Rendite Portfolio (%)</th>
</tr>
</thead>
<tbody>
<!-- rows injected -->
</tbody>
<tfoot>
<tr>
<td>Summen</td>
<td class="num" id="summarySumWeights">0,00 %</td>
<td class="num">Gesamtrendite:</td>
<td class="num" id="summarySumPortfolio">0,00 %</td>
</tr>
</tfoot>
</table>
</div>
</div>
</div>
<div class="portfolio-chart-grid mb-6" id="summaryPortfolioCharts">
<div class="card">
<h2 class="card-title">Gesamtübersicht</h2>
<div class="chart-shell"><canvas id="summaryPortfolioBar"></canvas></div>
</div>
<div class="card">
<h2 class="card-title">Anteilsverteilung</h2>
<div class="chart-shell"><canvas id="summaryAllocationPie"></canvas></div>
</div>
</div>
<!-- Zusatzabsicherungen Summary -->
<div class="card mb-6" id="insuranceSummary" style="display: none;">
<h2 class="card-title">Gewählte Zusatzabsicherungen</h2>
<!-- Insurance Cards Grid -->
<div class="grid-2 mb-6" id="insuranceCardsContainer" style="gap: 1.5rem;">
<!-- Dynamic insurance cards will be inserted here -->
</div>
<!-- Total Cost Summary -->
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 16px; padding: 2rem; text-align: center; margin-top: 2rem;">
<div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1.5rem;">
<div style="width: 48px; height: 48px; background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">💰</div>
<div>
<h3 style="font-size: 1.25rem; color: #1e293b; margin: 0; font-weight: 800;">Gesamtkosten aller Absicherungen</h3>
<p style="color: #64748b; font-size: 0.875rem; margin: 0; font-weight: 500;">Monatlicher Gesamtbeitrag für alle gewählten Versicherungen</p>
</div>
</div>
<div id="summaryTotalInsuranceCost" style="font-size: 2.5rem; font-weight: 900; color: #0369a1; margin-bottom: 0.5rem;">-</div>
<div style="color: #64748b; font-weight: 600; font-size: 1rem;">pro Monat</div>
</div>
</div>
<div class="card" style="background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); border: 2px solid #e5e7eb; padding: 1.5rem;">
<p style="text-align: center; font-size: 0.75rem; color: #6b7280; margin: 0; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-weight: 500; line-height: 1.4;">
<span style="font-size: 0.875rem;">⚠️</span>
<strong>Wichtiger Hinweis:</strong> Alle Berechnungen basieren auf den eingegebenen Annahmen und erfolgen ohne Gewähr. 
                    Die tatsächliche Entwicklung kann von den Prognosen abweichen. Vergangene Wertentwicklungen sind kein Indikator für zukünftige Ergebnisse.
                </p>
</div>
<div class="text-center mt-8 space-x-4">
<button class="btn-secondary" onclick="showPage('vorteile')">
<svg fill="currentColor" height="20" viewbox="0 0 24 24" width="20">
<path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"></path>
</svg>
                    Zurück
                </button>
<button class="btn-primary" onclick="window.print()">
<svg fill="currentColor" height="20" viewbox="0 0 24 24" width="20">
<path d="M18,3H6V7H18M19,12A1,1 0 0,1 18,11A1,1 0 0,1 19,10A1,1 0 0,1 20,11A1,1 0 0,1 19,12M16,19H8V14H16M19,8H5A3,3 0 0,0 2,11V17H6V21H18V17H22V11A3,3 0 0,0 19,8Z"></path>
</svg>
                    Drucken / PDF
                </button>
</div>
</div>
</main>
<script>
        let currentPage = 'kundendaten';
        let calculationData = {};
        let chart = null;
        let summaryChart = null;
        const chartStore = {};

        const performancePalette = {
            contributions: {
                border: '#475569',
                gradient: ['rgba(148, 163, 184, 0.35)', 'rgba(100, 116, 139, 0.05)']
            },
            smartKids: {
                border: '#1d4ed8',
                point: '#2563eb',
                gradient: ['rgba(37, 99, 235, 0.35)', 'rgba(37, 99, 235, 0.05)']
            },
            savings: {
                border: '#059669',
                point: '#10b981',
                gradient: ['rgba(16, 185, 129, 0.3)', 'rgba(16, 185, 129, 0.05)']
            },
            building: {
                border: '#d97706',
                point: '#f59e0b',
                gradient: ['rgba(245, 158, 11, 0.28)', 'rgba(245, 158, 11, 0.05)']
            }
        };

        const performanceAreaBackground = {
            id: 'performanceAreaBackground',
            beforeDraw(chartInstance) {
                const { ctx: chartCtx, chartArea } = chartInstance;
                if (!chartArea) return;
                const { top, bottom, left, right } = chartArea;
                const gradient = chartCtx.createLinearGradient(0, top, 0, bottom);
                gradient.addColorStop(0, 'rgba(226, 232, 240, 0.25)');
                gradient.addColorStop(1, 'rgba(248, 250, 252, 0.05)');

                chartCtx.save();
                chartCtx.fillStyle = gradient;
                chartCtx.fillRect(left, top, right - left, bottom - top);
                chartCtx.restore();
            }
        };

        const performanceGlow = {
            id: 'performanceGlow',
            afterDatasetsDraw(chartInstance) {
                const { ctx: chartCtx } = chartInstance;
                chartCtx.save();
                chartInstance.data.datasets.forEach((dataset, index) => {
                    if (!dataset.enableGlow) return;
                    const meta = chartInstance.getDatasetMeta(index);
                    if (meta.hidden) return;

                    chartCtx.shadowColor = dataset.borderColor;
                    chartCtx.shadowBlur = 14;
                    chartCtx.shadowOffsetX = 0;
                    chartCtx.shadowOffsetY = 0;
                    meta.dataset.draw(chartCtx);
                });
                chartCtx.restore();
            }
        };

        function buildPerformanceGradient(context, colors) {
            const { chart } = context;
            const { ctx: gradientCtx, chartArea } = chart || {};
            if (!chartArea) {
                return colors[0];
            }
            const gradient = gradientCtx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
            gradient.addColorStop(0, colors[0]);
            gradient.addColorStop(1, colors[1]);
            return gradient;
        }

        function generatePerformanceSeries() {
            if (!calculationData || !('duration' in calculationData)) {
                return null;
            }

            const years = [];
            const smartKidsData = [];
            const savingsData = [];
            const buildingData = [];
            const contributionsData = [];

            const {
                childAge = 0,
                startCapital = 0,
                monthlyAmount = 0,
                smartKidsTarget = 0,
                duration = 0
            } = calculationData;

            for (let year = 0; year <= duration; year++) {
                years.push(childAge + year);

                const contributions = startCapital + monthlyAmount * 12 * year;
                contributionsData.push(contributions);

                const progress = duration === 0 ? 0 : year / duration;
                const smartKidsValue = startCapital + (smartKidsTarget - startCapital) * progress;
                smartKidsData.push(smartKidsValue);

                let savingsValue = startCapital;
                for (let y = 0; y < year; y++) {
                    savingsValue = savingsValue * 1.005 + monthlyAmount * 12;
                }
                savingsData.push(savingsValue);

                let buildingValue = startCapital * 0.99;
                for (let y = 0; y < year; y++) {
                    buildingValue = buildingValue * 1.01 + monthlyAmount * 12;
                }
                buildingData.push(buildingValue);
            }

            return { years, smartKidsData, savingsData, buildingData, contributionsData };
        }

        function createPerformanceDatasets(series) {
            return [
                {
                    label: 'Ihre Einzahlungen',
                    data: series.contributionsData,
                    borderColor: performancePalette.contributions.border,
                    backgroundColor: context => buildPerformanceGradient(context, performancePalette.contributions.gradient),
                    borderWidth: 2,
                    borderDash: [8, 6],
                    pointRadius: 0,
                    tension: 0.35,
                    fill: true,
                    enableGlow: false
                },
                {
                    label: 'SmartKidsInvest',
                    data: series.smartKidsData,
                    borderColor: performancePalette.smartKids.border,
                    backgroundColor: context => buildPerformanceGradient(context, performancePalette.smartKids.gradient),
                    borderWidth: 4,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    pointHoverBorderWidth: 3,
                    pointHoverBackgroundColor: performancePalette.smartKids.point,
                    pointHoverBorderColor: '#fff',
                    tension: 0.38,
                    fill: true,
                    enableGlow: true
                },
                {
                    label: 'Sparbuch',
                    data: series.savingsData,
                    borderColor: performancePalette.savings.border,
                    backgroundColor: context => buildPerformanceGradient(context, performancePalette.savings.gradient),
                    borderWidth: 3,
                    pointRadius: 0,
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: performancePalette.savings.point,
                    pointHoverBorderColor: '#fff',
                    tension: 0.32,
                    fill: true,
                    enableGlow: true
                },
                {
                    label: 'Bausparvertrag',
                    data: series.buildingData,
                    borderColor: performancePalette.building.border,
                    backgroundColor: context => buildPerformanceGradient(context, performancePalette.building.gradient),
                    borderWidth: 3,
                    pointRadius: 0,
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: performancePalette.building.point,
                    pointHoverBorderColor: '#fff',
                    tension: 0.32,
                    fill: true,
                    enableGlow: true
                }
            ];
        }

        function buildPerformanceConfig(series) {
            return {
                type: 'line',
                data: {
                    labels: series.years,
                    datasets: createPerformanceDatasets(series)
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#0f172a',
                                usePointStyle: true,
                                pointStyle: 'circle',
                                font: {
                                    size: 14,
                                    weight: '600'
                                },
                                padding: 18
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#0f172a',
                            borderWidth: 0,
                            padding: 14,
                            cornerRadius: 12,
                            titleFont: {
                                weight: '700',
                                size: 14
                            },
                            bodyFont: {
                                weight: '600',
                                size: 13
                            },
                            callbacks: {
                                label(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Alter des Kindes',
                                font: {
                                    size: 14,
                                    weight: '700'
                                },
                                color: '#0f172a'
                            },
                            ticks: {
                                color: '#475569',
                                font: {
                                    weight: '600'
                                }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.2)',
                                drawBorder: false
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Vermögen (€)',
                                font: {
                                    size: 14,
                                    weight: '700'
                                },
                                color: '#0f172a'
                            },
                            ticks: {
                                color: '#475569',
                                font: {
                                    weight: '600'
                                },
                                callback(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.18)',
                                drawBorder: false
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    },
                    elements: {
                        line: {
                            capBezierPoints: true
                        }
                    }
                },
                plugins: [performanceAreaBackground, performanceGlow]
            };
        }

        function renderPerformanceChart(canvasId, existingChart) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                return existingChart;
            }

            const ctx = canvas.getContext('2d');
            if (existingChart) {
                existingChart.destroy();
            }

            const series = generatePerformanceSeries();
            if (!series) {
                return null;
            }

            return new Chart(ctx, buildPerformanceConfig(series));
        }


        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
    showPage('kundendaten');
            document.getElementById('consultationDate').value = new Date().toISOString().split('T')[0];
            updateLivePreview();
            calculateDentalTotal();
            updateTotalInsuranceCost();
        });

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show selected page
            document.getElementById(`page-${pageId}`).classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-tab').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find the correct nav tab to activate
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                if (tab.getAttribute('onclick') && tab.getAttribute('onclick').includes(pageId)) {
                    tab.classList.add('active');
                }
            });
            
            currentPage = pageId;
            
            // Update summary when showing summary page
            if (pageId === 'zusammenfassung') {
                updateSummary();
            }
        }

        function toggleBeitragsanstieg() {
            const checkbox = document.getElementById('dentalBeitragsanstieg');
            const fields = document.getElementById('beitragsanstiegFields');
            const container = checkbox.closest('.checkbox-container');
            
            if (checkbox.checked) {
                fields.style.display = 'block';
                container.classList.add('active');
            } else {
                fields.style.display = 'none';
                container.classList.remove('active');
            }
            
            calculateDentalTotal();
        }

        function formatInsuranceAmount(fieldId) {
            const input = document.getElementById(fieldId);
            let value = input.value.replace(/\./g, '').replace(/[^\d]/g, '');
            
            if (value) {
                value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                input.value = value;
            }
        }

        function calculateDentalTotal() {
            const childAge = parseInt(document.getElementById('childAge').value) || 5;
            const monthlyPrice = parseFloat(document.getElementById('dentalInsurancePrice').value) || 12;
            const beitragsanstieg = document.getElementById('dentalBeitragsanstieg').checked;
            
            let totalCost = 0;
            const yearsUntil18 = 18 - childAge;
            
            if (beitragsanstieg) {
                const increaseYear = parseInt(document.getElementById('dentalIncreaseYear').value) || 10;
                const newPrice = parseFloat(document.getElementById('dentalNewPrice').value) || 18;
                
                // Calculate years before and after increase
                const yearsBeforeIncrease = Math.max(0, Math.min(increaseYear - childAge, yearsUntil18));
                const yearsAfterIncrease = Math.max(0, yearsUntil18 - yearsBeforeIncrease);
                
                totalCost = (yearsBeforeIncrease * monthlyPrice * 12) + (yearsAfterIncrease * newPrice * 12);
            } else {
                totalCost = yearsUntil18 * monthlyPrice * 12;
            }
            
            document.getElementById('dentalTotalCost').textContent = formatCurrency(totalCost);
            updateTotalInsuranceCost();
        }

        function updateTotalInsuranceCost() {
            const deathPrice = parseFloat(document.getElementById('deathInsurancePrice').value) || 0;
            const dentalPrice = parseFloat(document.getElementById('dentalInsurancePrice').value) || 0;
            const disabilityPrice = parseFloat(document.getElementById('disabilityInsurancePrice').value) || 0;
            const stationaryPrice = parseFloat(document.getElementById('stationaryInsurancePrice').value) || 0;
            
            const totalMonthlyCost = deathPrice + dentalPrice + disabilityPrice + stationaryPrice;
            
            const totalCostElement = document.getElementById('totalInsuranceCost');
            const breakdownElement = document.getElementById('insuranceBreakdown');
            
            if (totalCostElement) {
                totalCostElement.textContent = formatCurrency(totalMonthlyCost) + '/Monat';
            }
            
            if (breakdownElement) {
                let breakdownHTML = '';
                
                if (deathPrice > 0) {
                    breakdownHTML += `<div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;"><span>🛡️ Risikolebensversicherung:</span><span>${formatCurrency(deathPrice)}/Monat</span></div>`;
                }
                
                if (dentalPrice > 0) {
                    breakdownHTML += `<div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;"><span>🦷 Zahnzusatzversicherung:</span><span>${formatCurrency(dentalPrice)}/Monat</span></div>`;
                }
                
                if (disabilityPrice > 0) {
                    breakdownHTML += `<div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;"><span>🚫 Schüler-BU:</span><span>${formatCurrency(disabilityPrice)}/Monat</span></div>`;
                }
                
                if (stationaryPrice > 0) {
                    breakdownHTML += `<div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;"><span>🏥 Stationäre Zusatzversicherung:</span><span>${formatCurrency(stationaryPrice)}/Monat</span></div>`;
                }
                
                if (breakdownHTML === '') {
                    breakdownHTML = '<div style="color: #6b7280; font-style: italic;">Keine Absicherungen ausgewählt</div>';
                } else {
                    breakdownHTML += `<div style="border-top: 2px solid #0ea5e9; padding-top: 1rem; margin-top: 1rem; display: flex; justify-content: space-between; font-weight: 800; font-size: 1.125rem;"><span>Gesamt:</span><span>${formatCurrency(totalMonthlyCost)}/Monat</span></div>`;
                }
                
                breakdownElement.innerHTML = breakdownHTML;
            }
        }

        function formatTargetAmount() {
            const input = document.getElementById('smartKidsTarget');
            let value = input.value.replace(/\./g, '').replace(/[^\d]/g, '');
            
            if (value) {
                // Add dots every 3 digits from the right
                value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                input.value = value;
            }
        }

        function updateLivePreview() {
            const childAge = parseInt(document.getElementById('childAge').value) || 0;
            const endAge = parseInt(document.getElementById('endAge').value) || 67;
            const startCapital = parseFloat(document.getElementById('startCapital').value) || 0;
            const monthlyAmount = parseFloat(document.getElementById('monthlyAmount').value) || 100;
            const smartKidsTargetStr = document.getElementById('smartKidsTarget').value || '250.000';
            const smartKidsTarget = parseFloat(smartKidsTargetStr.replace(/\./g, '')) || 250000;
            const effectiveCosts = parseFloat(document.getElementById('effectiveCosts').value) || 0.6;
            
            const duration = endAge - childAge;
            const durationTo40 = 40 - childAge;
            // Calculate closing costs always until 67, but total contributions until endAge
            const totalContributions = startCapital + (monthlyAmount * 12 * duration);
            const totalContributionsTo40 = startCapital + (monthlyAmount * 12 * durationTo40);
            const closingCosts = totalContributionsTo40 * 0.025;
            // Effective costs are calculated yearly on the total balance until endAge
            const totalEffectiveCosts = closingCosts + (smartKidsTarget * (effectiveCosts / 100) * duration);
            
            document.getElementById('previewDuration').textContent = duration + ' Jahre';
            document.getElementById('previewTotal').textContent = formatCurrency(totalContributions);
            document.getElementById('previewClosingCosts').textContent = formatCurrency(closingCosts);
            document.getElementById('previewEffectiveCosts').textContent = effectiveCosts + '% p.a.';
            document.getElementById('previewSmartKidsTarget').textContent = formatCurrency(smartKidsTarget);
            document.getElementById('displayEffectiveCosts').textContent = effectiveCosts + '%';
            
            // Update company info display
            updateCompanyInfo();
        }

        function updateCompanyInfo() {
            const company = document.getElementById('company').value;
            const baloiseInfo = document.getElementById('baloiseInfo');
            const alteLeipzigerInfo = document.getElementById('alteLeipzigerInfo');
            const nuernbergerInfo = document.getElementById('nuernbergerInfo');
            const lv1871Info = document.getElementById('lv1871Info');
            const allianzInfo = document.getElementById('allianzInfo');
            const companyTitle = document.getElementById('companyTitle');
            const companySubtitle = document.getElementById('companySubtitle');
            
            // Hide all company info sections first
            baloiseInfo.classList.add('hidden');
            alteLeipzigerInfo.classList.add('hidden');
            nuernbergerInfo.classList.add('hidden');
            lv1871Info.classList.add('hidden');
            allianzInfo.classList.add('hidden');
            
            if (company === 'baloise') {
                baloiseInfo.classList.remove('hidden');
                companyTitle.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; gap: 1rem;"><img src="baloise-logo.png" alt="Baloise" style="height:48px; margin-bottom:1rem;"></div>';
                companySubtitle.textContent = 'Lebensversicherung - Warum wir diese Gesellschaft empfehlen';
            } else if (company === 'alte-leipziger') {
                alteLeipzigerInfo.classList.remove('hidden');
                companyTitle.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; gap: 1rem;"><img src="Logo_Alte_Leipziger.png" alt="Alte Leipziger" style="height:48px; margin-bottom:1rem;"></div>';
                companySubtitle.textContent = 'Lebensversicherung - Warum wir diese Gesellschaft empfehlen';
            } else if (company === 'nuernberger') {
                nuernbergerInfo.classList.remove('hidden');
                companyTitle.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; gap: 1rem;"><img src="Logo-Nürnberger.png" alt="Nürnberger" style="height:48px; margin-bottom:1rem;"></div>';
                companySubtitle.textContent = 'Lebensversicherung - Warum wir diese Gesellschaft empfehlen';
            } else if (company === 'lv1871') {
                lv1871Info.classList.remove('hidden');
                companyTitle.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; gap: 1rem;"><img src="LV_1871_logo.png" alt="LV 1871" style="height:48px; margin-bottom:1rem;"></div>';
                companySubtitle.textContent = 'Lebensversicherung - Warum wir diese Gesellschaft empfehlen';
            } else if (company === 'allianz') {
                allianzInfo.classList.remove('hidden');
                companyTitle.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; gap: 1rem;"><img src="allianz-logo.png" alt="Allianz" style="height:48px; margin-bottom:1rem;"></div>';
                companySubtitle.textContent = 'Lebensversicherung - Warum wir diese Gesellschaft empfehlen';
            }
        }

        function calculateAndShowResults() {
            const childAge = parseInt(document.getElementById('childAge').value) || 5;
            const endAge = parseInt(document.getElementById('endAge').value) || 67;
            const startCapital = parseFloat(document.getElementById('startCapital').value) || 0;
            const monthlyAmount = parseFloat(document.getElementById('monthlyAmount').value) || 100;
            const smartKidsTargetStr = document.getElementById('smartKidsTarget').value || '250.000';
            const smartKidsTarget = parseFloat(smartKidsTargetStr.replace(/\./g, '')) || 250000;
            
            const duration = endAge - childAge;
            const totalContributions = startCapital + (monthlyAmount * 12 * duration);
            
            // Calculate results for different investment options
            const savingsResult = calculateSavingsBook(startCapital, monthlyAmount, duration);
            const buildingResult = calculateBuildingSavings(startCapital, monthlyAmount, duration);
            
            // Store calculation data
            calculationData = {
                childAge,
                endAge,
                startCapital,
                monthlyAmount,
                duration,
                totalContributions,
                smartKidsTarget,
                savingsResult,
                buildingResult
            };
            
            // Update result displays
            document.getElementById('resultEndAge').textContent = endAge;
            document.getElementById('resultContributions').textContent = formatCurrency(totalContributions);
            document.getElementById('resultSmartKids').textContent = formatCurrency(smartKidsTarget);
            document.getElementById('resultSavings').textContent = formatCurrency(savingsResult);
            document.getElementById('resultBuilding').textContent = formatCurrency(buildingResult);
            
            // Calculate returns
            const smartKidsReturn = ((smartKidsTarget - totalContributions) / totalContributions * 100).toFixed(1);
            const savingsReturn = ((savingsResult - totalContributions) / totalContributions * 100).toFixed(1);
            const buildingReturn = ((buildingResult - totalContributions) / totalContributions * 100).toFixed(1);
            
            document.getElementById('resultSmartKidsReturn').textContent = `+${smartKidsReturn}% Rendite`;
            document.getElementById('resultSavingsReturn').textContent = `+${savingsReturn}% Rendite`;
            document.getElementById('resultBuildingReturn').textContent = `+${buildingReturn}% Rendite`;
            
            // Show results section and update buttons
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('calculateBtn').classList.add('hidden');
            document.getElementById('recalculateBtn').classList.remove('hidden');
            document.getElementById('nextToVorteileBtn').classList.remove('hidden');
            
            // Create chart
            createComparisonChart();
        }

        function calculateSavingsBook(startCapital, monthlyAmount, duration) {
            const interestRate = 0.005; // 0.5% annual interest
            let balance = startCapital;
            
            for (let year = 0; year < duration; year++) {
                balance = balance * (1 + interestRate) + (monthlyAmount * 12);
            }
            
            return Math.round(balance);
        }

        function calculateBuildingSavings(startCapital, monthlyAmount, duration) {
            const interestRate = 0.01; // 1.0% annual interest
            const totalContributions = startCapital + (monthlyAmount * 12 * duration);
            const closingFee = totalContributions * 0.01; // 1% closing fee
            
            let balance = startCapital - (startCapital * 0.01); // Apply closing fee to start capital
            
            for (let year = 0; year < duration; year++) {
                const yearlyContribution = monthlyAmount * 12;
                balance = balance * (1 + interestRate) + yearlyContribution;
            }
            
            return Math.round(balance - closingFee);
        }

        function createComparisonChart() {
            chart = renderPerformanceChart('comparisonChart', chart);
        }

        function updateSummary() {
            // Update basic info
            document.getElementById('summaryCustomer').textContent = document.getElementById('customerName').value || '-';
            document.getElementById('summaryChild').textContent = document.getElementById('childName').value || '-';
            document.getElementById('summaryAdvisor').textContent = document.getElementById('advisorName').value || '-';
            
            // Format date to German format (DD.MM.YYYY)
            const dateValue = document.getElementById('consultationDate').value;
            if (dateValue) {
                const date = new Date(dateValue);
                const formattedDate = date.toLocaleDateString('de-DE');
                document.getElementById('summaryDate').textContent = formattedDate;
            } else {
                document.getElementById('summaryDate').textContent = '-';
            }

            try {
                if (typeof recalc === 'function') {
                    recalc();
                }
            } catch (e) {
                console.error('Recalc failed inside updateSummary', e);
            }
            
            // Update company info in summary
            updateSummaryCompanyInfo();
            
            // Update calculation parameters
            const startCapital = parseFloat(document.getElementById('startCapital').value) || 0;
            const monthlyAmount = parseFloat(document.getElementById('monthlyAmount').value) || 100;
            const childAge = parseInt(document.getElementById('childAge').value) || 5;
            const endAge = parseInt(document.getElementById('endAge').value) || 67;
            const smartKidsTargetStr = document.getElementById('smartKidsTarget').value || '250.000';
            const smartKidsTarget = parseFloat(smartKidsTargetStr.replace(/\./g, '')) || 250000;
            
            const duration = endAge - childAge;
            const totalContributions = startCapital + (monthlyAmount * 12 * duration);
            
            document.getElementById('summaryStartCapital').textContent = formatCurrency(startCapital);
            document.getElementById('summaryMonthly').textContent = formatCurrency(monthlyAmount);
            document.getElementById('summaryDuration').textContent = duration + ' Jahre';
            document.getElementById('summarySmartKidsTarget').textContent = formatCurrency(smartKidsTarget);

            // Calculate and display return
            const smartKidsReturn = ((smartKidsTarget - totalContributions) / totalContributions * 100).toFixed(1);
            document.getElementById('summaryReturn').textContent = `+${smartKidsReturn}%`;

            const effectiveCostsRate = parseFloat(document.getElementById('effectiveCosts').value) || 0;
            const durationTo40 = Math.max(0, Math.min(40 - childAge, duration));
            const totalContributionsTo40 = startCapital + (monthlyAmount * 12 * durationTo40);
            const closingCosts = totalContributionsTo40 * 0.025;

            const percentFormatter = typeof window.__fmtPct === 'function'
                ? window.__fmtPct
                : (value) => `${(Number(value) || 0).toFixed(2).replace('.', ',')} %`;

            document.getElementById('summaryEffectiveCosts').textContent = `${percentFormatter(effectiveCostsRate)} p.a.`;
            document.getElementById('summaryClosingCosts').textContent = formatCurrency(closingCosts);

            // Update result cards
            if (calculationData.totalContributions) {
                document.getElementById('summaryContributions').textContent = formatCurrency(calculationData.totalContributions);
                document.getElementById('summarySmartKids').textContent = formatCurrency(calculationData.smartKidsTarget);
                document.getElementById('summarySavings').textContent = formatCurrency(calculationData.savingsResult);
                document.getElementById('summaryBuilding').textContent = formatCurrency(calculationData.buildingResult);
                
                // Update returns
                const smartKidsRet = ((calculationData.smartKidsTarget - calculationData.totalContributions) / calculationData.totalContributions * 100).toFixed(1);
                const savingsRet = ((calculationData.savingsResult - calculationData.totalContributions) / calculationData.totalContributions * 100).toFixed(1);
                const buildingRet = ((calculationData.buildingResult - calculationData.totalContributions) / calculationData.totalContributions * 100).toFixed(1);
                
                document.getElementById('smartKidsReturn').textContent = `+${smartKidsRet}% Rendite`;
                document.getElementById('savingsReturn').textContent = `+${savingsRet}% Rendite`;
                document.getElementById('buildingReturn').textContent = `+${buildingRet}% Rendite`;
            }
            
            // Update insurance summary
            updateInsuranceSummary();
            
            // Create summary chart
            createSummaryChart();
        }

        function updateInsuranceSummary() {
            const deathPrice = parseFloat(document.getElementById('deathInsurancePrice').value) || 0;
            const dentalPrice = parseFloat(document.getElementById('dentalInsurancePrice').value) || 0;
            const disabilityPrice = parseFloat(document.getElementById('disabilityInsurancePrice').value) || 0;
            const stationaryPrice = parseFloat(document.getElementById('stationaryInsurancePrice').value) || 0;
            
            const totalMonthlyCost = deathPrice + dentalPrice + disabilityPrice + stationaryPrice;
            
            if (totalMonthlyCost > 0) {
                document.getElementById('insuranceSummary').style.display = 'block';
                
                let cardsHTML = '';
                
                if (deathPrice > 0) {
                    const company = document.getElementById('deathInsuranceCompany').value || 'Allianz Leben';
                    const amount = document.getElementById('deathInsuranceAmount').value || '100.000';
                    const duration = document.getElementById('deathInsuranceDuration').value || '20';
                    const type = document.getElementById('deathInsuranceType').value || 'konstant';
                    
                    cardsHTML += `
                        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 16px; padding: 2rem; position: relative; overflow: hidden; display: flex; flex-direction: column;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);"></div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 40px; height: 40px; background: rgba(217, 119, 6, 0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;">⚠️</div>
                                <div>
                                    <h4 style="color: #92400e; font-weight: 800; margin: 0; font-size: 1.125rem;">Risikolebensversicherung</h4>
                                    <p style="color: #a16207; font-size: 0.875rem; margin: 0; font-weight: 600;">${company}</p>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.6); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: #92400e; font-weight: 600; font-size: 0.875rem;">Absicherungshöhe:</span>
                                    <span style="color: #92400e; font-weight: 700; font-size: 0.875rem;">${amount}€</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: #92400e; font-weight: 600; font-size: 0.875rem;">Laufzeit:</span>
                                    <span style="color: #92400e; font-weight: 700; font-size: 0.875rem;">${duration} Jahre</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #92400e; font-weight: 600; font-size: 0.875rem;">Verlauf:</span>
                                    <span style="color: #92400e; font-weight: 700; font-size: 0.875rem;">${type}</span>
                                </div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(217, 119, 6, 0.1); border-radius: 8px; margin-top: auto;">
                                <div style="font-size: 1.75rem; font-weight: 900; color: #92400e;">${formatCurrency(deathPrice)}</div>
                                <div style="color: #a16207; font-weight: 600; font-size: 0.875rem;">pro Monat</div>
                            </div>
                        </div>
                    `;
                }
                
                if (dentalPrice > 0) {
                    const company = document.getElementById('dentalInsuranceCompany').value || 'ERGO Direkt';
                    const level = document.getElementById('dentalInsuranceLevel').value || '90';
                    const orthodonticsLevel = document.getElementById('dentalOrthodonticsLevel').value || '90';
                    
                    cardsHTML += `
                        <div style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 2px solid #10b981; border-radius: 16px; padding: 2rem; position: relative; overflow: hidden; display: flex; flex-direction: column;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #10b981 0%, #059669 100%);"></div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 40px; height: 40px; background: rgba(16, 185, 129, 0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;">🦷</div>
                                <div>
                                    <h4 style="color: #065f46; font-weight: 800; margin: 0; font-size: 1.125rem;">Zahnzusatzversicherung</h4>
                                    <p style="color: #047857; font-size: 0.875rem; margin: 0; font-weight: 600;">${company}</p>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.6); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: #065f46; font-weight: 600; font-size: 0.875rem;">Zahnersatz-Erstattung:</span>
                                    <span style="color: #065f46; font-weight: 700; font-size: 0.875rem;">${level}%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #065f46; font-weight: 600; font-size: 0.875rem;">Kieferorthopädie:</span>
                                    <span style="color: #065f46; font-weight: 700; font-size: 0.875rem;">${orthodonticsLevel}%</span>
                                </div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin-top: auto;">
                                <div style="font-size: 1.75rem; font-weight: 900; color: #065f46;">${formatCurrency(dentalPrice)}</div>
                                <div style="color: #047857; font-weight: 600; font-size: 0.875rem;">pro Monat</div>
                            </div>
                        </div>
                    `;
                }
                
                if (disabilityPrice > 0) {
                    const company = document.getElementById('disabilityInsuranceCompany').value || 'Continentale';
                    const rent = document.getElementById('disabilityInsuranceRent').value || '1500';
                    const age = document.getElementById('disabilityInsuranceAge').value || '67';
                    
                    cardsHTML += `
                        <div style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); border: 2px solid #ec4899; border-radius: 16px; padding: 2rem; position: relative; overflow: hidden; display: flex; flex-direction: column;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ec4899 0%, #be185d 100%);"></div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 40px; height: 40px; background: rgba(236, 72, 153, 0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;">🛡️</div>
                                <div>
                                    <h4 style="color: #831843; font-weight: 800; margin: 0; font-size: 1.125rem;">Schüler-BU</h4>
                                    <p style="color: #be185d; font-size: 0.875rem; margin: 0; font-weight: 600;">${company}</p>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.6); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: #831843; font-weight: 600; font-size: 0.875rem;">BU-Rente:</span>
                                    <span style="color: #831843; font-weight: 700; font-size: 0.875rem;">${formatCurrency(rent)}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #831843; font-weight: 600; font-size: 0.875rem;">Endalter:</span>
                                    <span style="color: #831843; font-weight: 700; font-size: 0.875rem;">${age} Jahre</span>
                                </div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(236, 72, 153, 0.1); border-radius: 8px; margin-top: auto;">
                                <div style="font-size: 1.75rem; font-weight: 900; color: #831843;">${formatCurrency(disabilityPrice)}</div>
                                <div style="color: #be185d; font-weight: 600; font-size: 0.875rem;">pro Monat</div>
                            </div>
                        </div>
                    `;
                }
                
                if (stationaryPrice > 0) {
                    const company = document.getElementById('stationaryInsuranceCompany').value || 'DKV';
                    const level = document.getElementById('stationaryInsuranceLevel').value || '1-bett';
                    const reimbursement = document.getElementById('stationaryInsuranceReimbursement').value || '100';
                    
                    const levelText = level.replace('1-bett', '1-Bett-Zimmer').replace('2-bett', '2-Bett-Zimmer').replace('chefarzt', 'Chefarztbehandlung').replace('komplett', 'Komplett-Schutz');
                    
                    cardsHTML += `
                        <div style="background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%); border: 2px solid #3b82f6; border-radius: 16px; padding: 2rem; position: relative; overflow: hidden; display: flex; flex-direction: column;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);"></div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;">🏥</div>
                                <div>
                                    <h4 style="color: #1e3a8a; font-weight: 800; margin: 0; font-size: 1.125rem;">Stationäre Zusatzversicherung</h4>
                                    <p style="color: #1d4ed8; font-size: 0.875rem; margin: 0; font-weight: 600;">${company}</p>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.6); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: #1e3a8a; font-weight: 600; font-size: 0.875rem;">Leistungen:</span>
                                    <span style="color: #1e3a8a; font-weight: 700; font-size: 0.875rem;">${levelText}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #1e3a8a; font-weight: 600; font-size: 0.875rem;">Erstattung:</span>
                                    <span style="color: #1e3a8a; font-weight: 700; font-size: 0.875rem;">${reimbursement}%</span>
                                </div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; margin-top: auto;">
                                <div style="font-size: 1.75rem; font-weight: 900; color: #1e3a8a;">${formatCurrency(stationaryPrice)}</div>
                                <div style="color: #1d4ed8; font-weight: 600; font-size: 0.875rem;">pro Monat</div>
                            </div>
                        </div>
                    `;
                }
                
                document.getElementById('insuranceCardsContainer').innerHTML = cardsHTML;
                document.getElementById('summaryTotalInsuranceCost').textContent = formatCurrency(totalMonthlyCost);
            } else {
                document.getElementById('insuranceSummary').style.display = 'none';
            }
        }

        function createSummaryChart() {
            const canvas = document.getElementById('summaryChart');
            if (!canvas) {
                return;
            }

            if (!('duration' in calculationData) || calculationData.duration === undefined) {
                return;
            }

            summaryChart = renderPerformanceChart('summaryChart', summaryChart);
            window.summaryChart = summaryChart || null;
        }

        function updateSummaryCompanyInfo() {
            const company = document.getElementById('company').value;
            const summaryCompanyInfo = document.getElementById('summaryCompanyInfo');
            
            let companyHTML = '';
            
            if (company === 'baloise') {
                companyHTML = `
                    <div>
                        <img src="baloise-logo.png" alt="SmartKidsInvest" style="height:64px; margin-bottom:2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum Baloise?</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🏆 150+ Jahre Erfahrung</li>
                                    <li style="margin-bottom: 0.5rem;">💪 Finanzstärke AAA</li>
                                    <li style="margin-bottom: 0.5rem;">🌍 Europaweit tätig</li>
                                    <li>📈 Überdurchschnittliche Überschüsse</li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🎯 Flexible Fondsauswahl</li>
                                    <li style="margin-bottom: 0.5rem;">🔄 Kostenfreie Umschichtungen</li>
                                    <li style="margin-bottom: 0.5rem;">🛡️ Garantierte Beitragsrückgewähr</li>
                                    <li>⚡ Schnelle Auszahlung</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            } else if (company === 'alte-leipziger') {
                companyHTML = `
                    <div>
                        <img src="Logo_Alte_Leipziger.png" alt="SmartKidsInvest" style="height:64px; margin-bottom:2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum Alte Leipziger?</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🏆 200+ Jahre Tradition</li>
                                    <li style="margin-bottom: 0.5rem;">💎 Ausgezeichnete Ratings</li>
                                    <li style="margin-bottom: 0.5rem;">🎖️ Testsieger-Qualität</li>
                                    <li>📊 Hohe Überschussbeteiligung</li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🌟 AL_best Fonds</li>
                                    <li style="margin-bottom: 0.5rem;">🔒 Beitragsgarantie</li>
                                    <li style="margin-bottom: 0.5rem;">🎯 Flexible Strategien</li>
                                    <li>👨‍💼 Persönlicher Service</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            } else if (company === 'nuernberger') {
                companyHTML = `
                    <div>
                        <img src="Logo-Nürnberger.png" alt="SmartKidsInvest" style="height:64px; margin-bottom:2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum Nürnberger?</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🏆 100+ Jahre Erfahrung</li>
                                    <li style="margin-bottom: 0.5rem;">💪 Solide Finanzstärke</li>
                                    <li style="margin-bottom: 0.5rem;">🎯 Spezialist für Altersvorsorge</li>
                                    <li>📈 Attraktive Überschüsse</li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🎨 Breite Fondspalette</li>
                                    <li style="margin-bottom: 0.5rem;">🔄 Flexible Umschichtungen</li>
                                    <li style="margin-bottom: 0.5rem;">🛡️ Beitragserhalt garantiert</li>
                                    <li>🏠 Regionale Nähe</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            } else if (company === 'lv1871') {
                companyHTML = `
                    <div>
                        <img src="LV_1871_logo.png" alt="SmartKidsInvest" style="height:64px; margin-bottom:2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum LV 1871?</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🏆 150+ Jahre Tradition</li>
                                    <li style="margin-bottom: 0.5rem;">💪 Starke Finanzstärke</li>
                                    <li style="margin-bottom: 0.5rem;">🚀 Innovationsführer</li>
                                    <li>📈 Überdurchschnittliche Renditen</li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🎯 Maxxellence Invest</li>
                                    <li style="margin-bottom: 0.5rem;">🔄 Kostenfreie Switches</li>
                                    <li style="margin-bottom: 0.5rem;">🛡️ Beitragsgarantie</li>
                                    <li>📱 Digitaler Service</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            } else if (company === 'allianz') {
                companyHTML = `
                    <div>
                        <img src="allianz.png" alt="SmartKidsInvest" style="height:64px; margin-bottom:2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Warum Allianz?</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🏆 130+ Jahre Erfahrung</li>
                                    <li style="margin-bottom: 0.5rem;">💪 Marktführer Deutschland</li>
                                    <li style="margin-bottom: 0.5rem;">🌍 Weltweite Präsenz</li>
                                    <li>📈 Konstante Überschüsse</li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Besondere Vorteile</h4>
                                <ul style="list-style: none; padding: 0; margin: 0; color: #374151; font-size: 0.875rem; line-height: 1.6;">
                                    <li style="margin-bottom: 0.5rem;">🎯 InvestFlex Konzept</li>
                                    <li style="margin-bottom: 0.5rem;">🔄 Kostenfreie Umschichtungen</li>
                                    <li style="margin-bottom: 0.5rem;">🛡️ Beitragsgarantie</li>
                                    <li>🏆 Ausgezeichneter Service</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            summaryCompanyInfo.innerHTML = companyHTML;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('de-DE', {
                style: 'currency',
                currency: 'EUR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'965a26d86578e506',t:'MTc1MzU5ODQ5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  // Utilities
  const fmtPct = (v)=> new Intl.NumberFormat('de-DE',{minimumFractionDigits:2, maximumFractionDigits:2}).format(v) + " %";
  window.__fmtPct = fmtPct;
  const paletteBase = ['#2563eb','#d97706','#059669','#9333ea','#f97316','#0ea5e9','#f43f5e','#6366f1','#22c55e','#d946ef'];
  const getPalette = (n)=> Array.from({length:n}, (_,i)=> paletteBase[i % paletteBase.length]);

  const colorNormalizerCtx = document.createElement('canvas').getContext('2d');
  function normalizeColor(color){
    try {
      colorNormalizerCtx.fillStyle = '#000000';
      colorNormalizerCtx.fillStyle = color;
      return colorNormalizerCtx.fillStyle;
    } catch (e) {
      return '#d4af37';
    }
  }

  function shadeColor(color, percent){
    const normalized = normalizeColor(color).trim();
    let r = 212, g = 175, b = 55;
    if (normalized.startsWith('#')) {
      const hex = normalized.slice(1);
      const value = parseInt(hex.length === 3 ? hex.split('').map(ch => ch + ch).join('') : hex, 16);
      r = (value >> 16) & 255;
      g = (value >> 8) & 255;
      b = value & 255;
    } else {
      const match = normalized.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);
      if (match) {
        r = parseInt(match[1], 10);
        g = parseInt(match[2], 10);
        b = parseInt(match[3], 10);
      }
    }
    const t = percent < 0 ? 0 : 255;
    const p = Math.min(1, Math.max(0, Math.abs(percent)));
    const R = Math.round((t - r) * p) + r;
    const G = Math.round((t - g) * p) + g;
    const B = Math.round((t - b) * p) + b;
    return `rgb(${R}, ${G}, ${B})`;
  }

  function create3DGradient(ctx, color){
    const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height || 300);
    gradient.addColorStop(0, shadeColor(color, 0.35));
    gradient.addColorStop(0.3, shadeColor(color, 0.1));
    gradient.addColorStop(0.65, shadeColor(color, -0.05));
    gradient.addColorStop(1, shadeColor(color, -0.3));
    return gradient;
  }

  function createArcGradient(ctx, color){
    const width = ctx.canvas.clientWidth || ctx.canvas.width || 320;
    const height = ctx.canvas.clientHeight || ctx.canvas.height || 320;
    const radius = Math.max(width, height) / 2;
    const cx = width / 2;
    const cy = height / 2;
    const gradient = ctx.createRadialGradient(cx, cy, radius * 0.15, cx, cy, radius);
    gradient.addColorStop(0, shadeColor(color, 0.35));
    gradient.addColorStop(0.45, shadeColor(color, 0.05));
    gradient.addColorStop(0.75, shadeColor(color, -0.1));
    gradient.addColorStop(1, shadeColor(color, -0.35));
    return gradient;
  }

  const tbody = document.getElementById('fundTableBody');
  if(!tbody) return;

  const addBtn = document.getElementById('addFundRowBtn');
  const clearBtn = document.getElementById('clearFundsBtn');
  const sumWeightsCell = document.getElementById('sumWeightsCell');
  const sumPortfolioCell = document.getElementById('sumPortfolioCell');
  const sumEl = document.getElementById('sumPortfolioReturn');
  const effDisp = document.getElementById('effectiveCostsDisplay');
  const netDisp = document.getElementById('netReturnDisplay');

  function readEff(){
    const input = document.getElementById('effectiveCosts');
    const raw = input ? String(input.value).replace(',','.') : '0.6';
    const v = parseFloat(raw);
    return isNaN(v)?0:v;
  }

  function addRow(name='', w='', r5=''){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" value="${name}"/></td>
      <td class="num"><input type="number" step="0.01" value="${w}"/></td>
      <td class="num"><input type="number" step="0.01" value="${r5}"/></td>
      <td class="num cell-strong portfolioReturnCell">0,00 %</td>
      <td class="num"><button aria-label="Zeile löschen" class="icon-btn btn-remove" title="Zeile löschen">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
  <polyline points="3 6 5 6 21 6"></polyline>
  <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
  <path d="M10 11v6"></path>
  <path d="M14 11v6"></path>
  <path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path>
</svg>
</button></td>`;
    tbody.appendChild(tr);
    tr.querySelectorAll('input').forEach(i => i.addEventListener('input', recalc));
  }

  // event delegation for remove
  tbody.addEventListener('click', (e)=>{
    const b = e.target.closest('.btn-remove');
    if(b){ b.closest('tr')?.remove(); recalc(); }
  });

  addBtn.addEventListener('click', ()=> addRow());

  clearBtn.addEventListener('click', ()=> { tbody.innerHTML=''; recalc(); });

  function getData(){
    return Array.from(tbody.querySelectorAll('tr')).map(row=>{
      const ins = row.querySelectorAll('input');
      const name = (ins[0]?.value || 'Fonds').trim() || 'Fonds';
      const w = parseFloat((ins[1]?.value || '0').replace(',','.')) || 0;
      const r5 = parseFloat((ins[2]?.value || '0').replace(',','.')) || 0;
      return {name, weight:w, r5y:r5, contrib: w*r5/100};
    });
  }

  function syncBarChart(canvasId, palette, summaryVals){
    const canvas = document.getElementById(canvasId);
    if(!canvas) return;

    const ctx = canvas.getContext('2d');
    const gradients = palette.map(color => create3DGradient(ctx, color));
    const borders = palette.map(color => shadeColor(color, -0.4));
    const datasetConfig = {
      data: summaryVals,
      backgroundColor: gradients,
      borderColor: borders,
      borderWidth: 1.5,
      borderRadius: 8,
      hoverBackgroundColor: gradients,
      maxBarThickness: 64,
      bar3dBaseColors: palette
    };

    if(!chartStore[canvasId]){
      chartStore[canvasId] = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Gesamte Rendite','Effektivkosten','Rendite nach Kosten'],
          datasets: [datasetConfig]
        },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          datasets: {
            bar: {
              borderSkipped: false,
              categoryPercentage: 0.58,
              barPercentage: 0.58
            }
          },
          plugins: {
            legend: {
              position: 'bottom',
              onClick(evt, legendItem, legend) {
                const chart = legend?.chart;
                if (!chart) return;
                chart.toggleDataVisibility(legendItem.index);
                chart.update();
              },
              labels: {
                usePointStyle: true,
                boxWidth: 12,
                padding: 16,
                color: '#0f172a',
                font: {
                  weight: 600
                },
                generateLabels(chart) {
                  const dataset = chart.data.datasets?.[0];
                  if (!dataset) {
                    return [];
                  }
                  return chart.data.labels.map((label, index) => {
                    const value = Array.isArray(dataset.data) ? dataset.data[index] : undefined;
                    const baseColors = dataset.bar3dBaseColors || dataset.backgroundColor || [];
                    const fill = Array.isArray(baseColors) ? baseColors[index] : baseColors;
                    const borderColors = dataset.borderColor || [];
                    const stroke = Array.isArray(borderColors) ? borderColors[index] : borderColors;
                    return {
                      text: `${label} – ${fmtPct(Number(value) || 0)}`,
                      fillStyle: fill || '#0f172a',
                      strokeStyle: stroke || '#0f172a',
                      lineWidth: 1,
                      hidden: chart.getDataVisibility(index) === false,
                      index,
                      datasetIndex: 0
                    };
                  });
                }
              }
            },
            tooltip:{ callbacks:{ label:(ctx)=> fmtPct(ctx.parsed.y) } },
            valueLabels: {
              color: '#0f172a',
              outlineColor: 'rgba(255,255,255,0.85)',
              outlineWidth: 4,
              font: { weight: 700, size: 12 },
              formatter: (value)=> fmtPct(value)
            }
          },
          scales: {
            x: {
              grid: { display:false },
              ticks: { color: '#334155', font: { weight: 600 } }
            },
            y: {
              beginAtZero:true,
              grid: { color: 'rgba(148, 163, 184, 0.25)' },
              ticks:{ color: '#475569', callback:(v)=> fmtPct(v) }
            }
          }
        }
      });
    } else {
      const chartInstance = chartStore[canvasId];
      const dataset = chartInstance.data.datasets[0];
      dataset.data = summaryVals;
      dataset.backgroundColor = gradients;
      dataset.borderColor = borders;
      dataset.hoverBackgroundColor = gradients;
      dataset.bar3dBaseColors = palette;
      chartInstance.update();
    }
  }

  function syncPieChart(canvasId, labels, palette, data){
    const canvas = document.getElementById(canvasId);
    if(!canvas) return;

    const ctx = canvas.getContext('2d');
    const fills = palette.map(color => createArcGradient(ctx, color));
    const borders = palette.map(color => shadeColor(color, -0.35));

    if(!chartStore[canvasId]){
      chartStore[canvasId] = new Chart(ctx, {
        type: 'pie',
        data: {
          labels,
          datasets: [{
            data,
            backgroundColor: fills,
            hoverBackgroundColor: fills,
            borderColor: borders,
            borderWidth: 1.5,
            hoverOffset: 12,
            legendBaseColors: palette
          }]
        },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins: {
            legend: {
              position: 'bottom',
              onClick(evt, legendItem, legend) {
                const chart = legend?.chart;
                if (!chart) return;
                chart.toggleDataVisibility(legendItem.index);
                chart.update();
              },
              labels: {
                usePointStyle: true,
                boxWidth: 12,
                padding: 16,
                color: '#0f172a',
                font: {
                  weight: 600
                },
                generateLabels(chart) {
                  const dataset = chart.data.datasets?.[0];
                  if (!dataset) {
                    return [];
                  }
                  const totals = Array.isArray(dataset.data) ? dataset.data : [];
                  const totalValue = totals.reduce((sum, value) => {
                    const numeric = Number(value);
                    return sum + (isFinite(numeric) ? numeric : 0);
                  }, 0);
                  return chart.data.labels.map((label, index) => {
                    const value = Number(totals[index]) || 0;
                    const percentage = totalValue === 0 ? 0 : (value / totalValue) * 100;
                    const baseColors = dataset.legendBaseColors || dataset.backgroundColor || [];
                    const fill = Array.isArray(baseColors) ? baseColors[index] : baseColors;
                    const borderColors = dataset.borderColor || [];
                    const stroke = Array.isArray(borderColors) ? borderColors[index] : borderColors;
                    return {
                      text: `${label} – ${fmtPct(percentage)}`,
                      fillStyle: fill || '#0f172a',
                      strokeStyle: stroke || '#0f172a',
                      lineWidth: 1,
                      hidden: chart.getDataVisibility(index) === false,
                      index,
                      datasetIndex: 0
                    };
                  });
                }
              }
            },
            tooltip: {
              callbacks: {
                label: (ctx) => `${ctx.label}: ${fmtPct(ctx.parsed)}`
              }
            },
            valueLabels: {
              color: '#0f172a',
              outlineColor: 'rgba(255,255,255,0.85)',
              outlineWidth: 4,
              font: { weight: 700, size: 12 },
              formatter: (value)=> fmtPct(value),
              pieFormatter: (_, context)=> fmtPct(context.percentage)
            }
          }
        }
      });
    } else {
      const chartInstance = chartStore[canvasId];
      chartInstance.data.labels = labels;
      chartInstance.data.datasets[0].data = data;
      chartInstance.data.datasets[0].backgroundColor = fills;
      chartInstance.data.datasets[0].hoverBackgroundColor = fills;
      chartInstance.data.datasets[0].borderColor = borders;
      chartInstance.data.datasets[0].legendBaseColors = palette;
      chartInstance.update();
    }
  }

  function ensureCharts(labels, retByFund, weights, r5s, summaryVals){
    const palette = getPalette(labels.length || 3);
    const summaryPalette = getPalette(summaryVals.length || 3);

    syncBarChart('chartSummaryBar', summaryPalette, summaryVals);
    syncBarChart('summaryPortfolioBar', summaryPalette, summaryVals);

    syncPieChart('chartAllocationPie', labels, palette, weights);
    syncPieChart('summaryAllocationPie', labels, palette, weights);
  }

  function recalc(){
    const data = getData();
    // per-row calc
    Array.from(tbody.querySelectorAll('tr')).forEach((row,i)=>{
      const cell = row.querySelector('.portfolioReturnCell');
      const v = data[i]?.contrib || 0;
      if(cell) cell.textContent = fmtPct(v);
    });

    const totalContrib = data.reduce((a,b)=> a+b.contrib, 0);
    const totalWeights = data.reduce((a,b)=> a+b.weight, 0);
    sumPortfolioCell.textContent = fmtPct(totalContrib);
    sumWeightsCell.textContent = fmtPct(totalWeights);
    sumEl.textContent = fmtPct(totalContrib);

    const eff = readEff();
    effDisp.textContent = fmtPct(eff);
    const net = totalContrib - eff;
    netDisp.textContent = fmtPct(net);

    

// --- Populate summary fund table (Zusammenfassung) ---
try {
  const summaryTableBody = document.querySelector('#summaryFundTable tbody');
  if (summaryTableBody) {
    summaryTableBody.innerHTML = '';
    data.forEach(d => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${d.name}</td>
                      <td class="num">${fmtPct(d.weight)}</td>
                      <td class="num">${fmtPct(d.r5y)}</td>
                      <td class="num">${fmtPct(d.contrib)}</td>`;
      summaryTableBody.appendChild(tr);
    });
    const sumW = document.getElementById('summarySumWeights');
    const sumP = document.getElementById('summarySumPortfolio');
    if (sumW) sumW.textContent = fmtPct(totalWeights);
    if (sumP) sumP.textContent = fmtPct(totalContrib);
  }
} catch(e){ /* no-op */ }

ensureCharts(
      data.map(d=>d.name),
      data.map(d=>d.contrib),
      data.map(d=>d.weight),
      data.map(d=>d.r5y),
      [ Math.max(totalContrib,0), Math.max(eff,0), Math.max(net,0) ]
    );
  }

  // Keep in sync with page 2 costs
  const effInput = document.getElementById('effectiveCosts');
  effInput?.addEventListener('input', recalc);

  // Initial calc
  recalc();
});
</script>
<!-- Professioneller Footer -->
<footer class="bg-[#0e1e3a] text-white mt-12 py-8 px-4 no-print">
<div class="max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center space-y-6 md:space-y-0">
<div class="flex items-center space-x-4">
<img alt="Lion Finance Logo" class="h-12 w-auto" src="smartkids-logo.png"/>
<div>
<p class="font-bold text-lg">SmartKidsInvest</p>
<p class="text-sm">Lise-Meitner-Straße 9<br/>24223 Schwentinental</p>
</div>
</div>
<div class="text-center md:text-right">
<p class="text-sm">Kontakt: <a class="text-gold hover:underline" href="mailto:info@smartkidsinvest.de">info@smartkidsinvest.de</a></p>
<p class="text-xs text-gray-400 mt-1">© SmartKidsInvest – Alle Rechte vorbehalten</p>
</div>
</div>
</footer>
<!-- Footer für Druckversion auf letzter Seite -->
<footer class="print-footer">
<div class="footer-inner">
<img alt="SmartKidsInvest Logo" src="smartkids-logo.png"/>
<p class="font-bold text-lg">SmartKidsInvest</p>
<p class="footer-text">Lise-Meitner-Straße 9 · 24223 Schwentinental</p>
<p class="footer-text">info@smartkidsinvest.de · © SmartKidsInvest – Alle Rechte vorbehalten</p>
</div>
</footer>
<script id="progress-controller">
(function(){
  const order = ["kundendaten","berechnung","fondsportfolio","gesellschaft","vorteile","zusatzabsicherungen","zusammenfassung"];
  const total = order.length;
  function setProgressByPage(pageId){
    const el = document.getElementById("progress-fill");
    if(!el) return;
    const idx = Math.max(0, order.indexOf(pageId));
    // progress goes from first step (min 1) to total
    const step = idx >= 0 ? (idx+1) : 1;
    const pct = Math.round((step/total)*100);
    el.style.width = pct + "%";
    el.setAttribute("aria-valuenow", String(pct));
    el.setAttribute("aria-valuemin","0");
    el.setAttribute("aria-valuemax","100");
  }
  // Try to patch showPage to call setProgressByPage without breaking existing logic
  const scriptPatch = function(){
    try{
      const orig = window.showPage;
      if (typeof orig === "function") {
        window.showPage = function(pageId){
          const r = orig.apply(this, arguments);
          setProgressByPage(pageId);
          return r;
        };
      }
    }catch(e){/* noop */}
  };
  document.addEventListener("DOMContentLoaded", function(){
    // initial state: detect visible page-content id
    const visible = document.querySelector('.page-content:not(.hidden)');
    const id = visible ? (visible.id||"page-kundendaten") : "page-kundendaten";
    const pageId = id.replace(/^page-/, "");
    setProgressByPage(pageId);
    scriptPatch();
  });
  // expose for manual use if needed
  window.__setProgressByPage = setProgressByPage;
})();
</script>

<script id="chart-value-labels">
(function(){
  function formatPercent(value){
    if (typeof window.__fmtPct === 'function') {
      return window.__fmtPct(value);
    }
    const numeric = Number(value) || 0;
    return `${numeric.toFixed(2).replace('.', ',')} %`;
  }

  function resolveFont(options){
    const defaults = (window.Chart && Chart.defaults && Chart.defaults.font) || {};
    const weight = options?.weight || '600';
    const size = options?.size || defaults.size || 12;
    const family = options?.family || defaults.family || 'sans-serif';
    const style = options?.style ? options.style + ' ' : '';
    return {
      string: `${style}${weight} ${size}px ${family}`,
      size,
      weight,
      family
    };
  }

  const plugin = {
    id: 'valueLabels',
    afterDatasetsDraw(chart, args, pluginOptions) {
      const opts = pluginOptions || {};
      if (opts.display === false) return;

      const { ctx, chartArea } = chart;
      if (!ctx || !chartArea) return;

      const color = opts.color || '#0f172a';
      const outlineColor = opts.outlineColor || 'rgba(255,255,255,0.85)';
      const outlineWidth = opts.outlineWidth ?? 3;
      const offset = opts.offset ?? 12;
      const font = resolveFont(opts.font || {});

      ctx.save();
      ctx.font = font.string;
      ctx.fillStyle = color;
      ctx.textAlign = 'center';

      chart.data.datasets.forEach((dataset, datasetIndex) => {
        const meta = chart.getDatasetMeta(datasetIndex);
        if (!meta || meta.hidden) return;
        const type = (dataset.type || meta.type || chart.config.type);

        if (type === 'bar') {
          meta.data.forEach((element, index) => {
            const rawValue = dataset.data[index];
            const numeric = Number(rawValue);
            if (!isFinite(numeric)) return;

            const formatter = typeof opts.formatter === 'function' ? opts.formatter : formatPercent;
            const text = formatter(numeric, { chart, dataset, dataIndex: index, datasetIndex });
            if (!text) return;

            const { x, y } = element.tooltipPosition();
            const isNegative = numeric < 0;
            let labelY = y + (isNegative ? offset : -offset);
            if (!isNegative && labelY < chartArea.top + 10) {
              labelY = chartArea.top + 10;
            }
            if (isNegative && labelY > chartArea.bottom - 4) {
              labelY = chartArea.bottom - 4;
            }

            ctx.textBaseline = isNegative ? 'top' : 'bottom';

            if (outlineWidth > 0) {
              ctx.lineWidth = outlineWidth;
              ctx.strokeStyle = outlineColor;
              ctx.strokeText(text, x, labelY);
            }
            ctx.fillText(text, x, labelY);
          });
        } else if (type === 'pie' || type === 'doughnut') {
          const total = dataset.data.reduce((sum, value) => {
            const numericValue = Number(value);
            return sum + (isFinite(numericValue) ? numericValue : 0);
          }, 0);
          meta.data.forEach((element, index) => {
            const rawValue = dataset.data[index];
            const numeric = Number(rawValue);
            if (!isFinite(numeric) || numeric === 0) return;

            const percentage = total === 0 ? 0 : (numeric / total) * 100;
            const formatter = typeof opts.pieFormatter === 'function'
              ? opts.pieFormatter
              : (value, context) => formatPercent(context.percentage);
            const text = formatter(numeric, {
              chart,
              dataset,
              dataIndex: index,
              datasetIndex,
              percentage
            });
            if (!text) return;

            const angle = element.startAngle + (element.endAngle - element.startAngle) / 2;
            const radius = element.innerRadius + (element.outerRadius - element.innerRadius) * 0.65;
            const x = element.x + Math.cos(angle) * radius;
            const y = element.y + Math.sin(angle) * radius;

            ctx.textBaseline = 'middle';

            if (outlineWidth > 0) {
              ctx.lineWidth = outlineWidth;
              ctx.strokeStyle = outlineColor;
              ctx.strokeText(text, x, y);
            }
            ctx.fillText(text, x, y);
          });
        }
      });

      ctx.restore();
    }
  };

  if (window.Chart) {
    const existing = Chart.registry?.getPlugin?.('valueLabels');
    if (!existing) {
      Chart.register(plugin);
    }
  }
})();
</script>

<script id="chartjs-3d-bars">
(function(){
  const ThreeDBar = {
    id: 'bar3d',
    afterDatasetDraw(chart, args) {
      const ds = chart.data.datasets[args.index];
      if (!ds) return;
      const type = (ds.type || chart.config.type);
      if (type !== 'bar') return;
      const {ctx} = chart;
      const meta = args.meta;
      const offset = 8;
      ctx.save();
      meta.data.forEach((bar, i) => {
        const p = bar.getProps(['x','y','base','width','height'], true);
        const x = p.x - p.width/2, y = p.y, w = p.width, h = Math.max(0, p.base - p.y);
        if (w<=0 || h<=0) return;

        const baseColor = Array.isArray(ds.bar3dBaseColors)
          ? ds.bar3dBaseColors[i % ds.bar3dBaseColors.length]
          : (ds.bar3dBaseColor || ds.bar3dColor || (Array.isArray(ds.backgroundColor) ? ds.backgroundColor[i] : ds.backgroundColor) || '#d4af37');

        const background = Array.isArray(ds.backgroundColor)
          ? ds.backgroundColor[i % ds.backgroundColor.length]
          : ds.backgroundColor;

        function shade(c, d){
          if (!c || typeof c !== 'string') return '#d4af37';
          let m = c.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
          let r,g,b;
          if (m){ r=+m[1]; g=+m[2]; b=+m[3]; }
          else {
            const hex = c.replace('#','');
            if (!/^[0-9a-fA-F]+$/.test(hex)) return '#d4af37';
            const v=parseInt(hex.length===3 ? hex.split('').map(ch=>ch+ch).join('') : hex,16);
            r=(v>>16)&255; g=(v>>8)&255; b=v&255;
          }
          r=Math.min(255,Math.max(0,r+d)); g=Math.min(255,Math.max(0,g+d)); b=Math.min(255,Math.max(0,b+d));
          return 'rgb('+r+','+g+','+b+')';
        }

        const frontFill = background && typeof background === 'object' && typeof background.addColorStop === 'function'
          ? background
          : shade(String(baseColor), -6);

        // top
        ctx.fillStyle = shade(String(baseColor),12);
        ctx.beginPath();
        ctx.moveTo(x,y); ctx.lineTo(x+offset,y-offset); ctx.lineTo(x+w+offset,y-offset); ctx.lineTo(x+w,y); ctx.closePath(); ctx.fill();
        // side
        ctx.fillStyle = shade(String(baseColor),-25);
        ctx.beginPath();
        ctx.moveTo(x+w,y); ctx.lineTo(x+w+offset,y-offset); ctx.lineTo(x+w+offset,y-offset+h); ctx.lineTo(x+w,y+h); ctx.closePath(); ctx.fill();
        // front
        ctx.fillStyle = frontFill;
        ctx.fillRect(x,y,w,h);
      });
      ctx.restore();
    }
  };
  if (window.Chart && !Chart.registry.getPlugin('bar3d')) Chart.register(ThreeDBar);
})();
</script>

<script id="bar-style-enforcer">
document.addEventListener('DOMContentLoaded', function(){
  if (!window.Chart || !Chart.instances) return;
  Object.values(Chart.instances).forEach(function(inst){
    try{
      const isBar = (inst.config.type === 'bar') || inst.config.data.datasets.some(ds => (ds.type||inst.config.type)==='bar');
      if (!isBar) return;
      inst.config.data.datasets.forEach(function(ds){
        if ((ds.type||inst.config.type)==='bar'){
          if (typeof ds.borderSkipped === 'undefined') ds.borderSkipped = false;
          ds.borderColor = ds.borderColor || '#b28a00';
          ds.backgroundColor = ds.backgroundColor || '#d4af37';
          ds.borderWidth = ds.borderWidth || 1;
        }
      });
      inst.update('none');
    }catch(e){}
  });
});
</script>

<script id="summary-chart-patch">
(function(){
  function rebuildSummaryLater(){
    if (typeof createSummaryChart !== 'function') return;
    // Rebuild after the page is visible and layout settled
    requestAnimationFrame(function(){
      requestAnimationFrame(function(){
        try{
          createSummaryChart();
          if (window.summaryChart && typeof window.summaryChart.resize === 'function'){
            window.summaryChart.resize();
          }
        }catch(e){}
      });
    });
  }
  // Patch showPage so that after switching to zusammenfassung, we rebuild chart
  if (!window.__showPagePatched) {
    window.__showPagePatched = true;
    var orig = window.showPage;
    if (typeof orig === 'function'){
      window.showPage = function(pageId){
        var r = orig.apply(this, arguments);
        if (pageId === 'zusammenfassung') rebuildSummaryLater();
        return r;
      };
    } else {
      // Fallback: on DOM ready, if already on zusammenfassung, rebuild
      document.addEventListener('DOMContentLoaded', function(){
        var visible = document.querySelector('#page-zusammenfassung:not(.hidden)');
        if (visible) rebuildSummaryLater();
      });
    }
  }
  // Also rebuild on window resize
  window.addEventListener('resize', function(){ 
    var visible = document.querySelector('#page-zusammenfassung:not(.hidden)');
    if (visible) rebuildSummaryLater();
  });
})();
</script>


<script id="summary-safe-guards">
(function(){
  // If insurance summary container was removed, prevent JS errors
  function safeUpdateInsuranceSummary(){
    try{
      var el = document.getElementById('insuranceSummary');
      if (!el) return; // nothing to do if the section doesn't exist
      // If it exists, call original if available
      if (typeof window.__origUpdateInsuranceSummary === 'function'){
        window.__origUpdateInsuranceSummary();
      }
    }catch(e){ /* swallow to keep summary running */ }
  }
  // Save original if present
  if (typeof window.updateInsuranceSummary === 'function' && !window.__origUpdateInsuranceSummary){
    window.__origUpdateInsuranceSummary = window.updateInsuranceSummary;
  }
  // Override with safe version
  window.updateInsuranceSummary = safeUpdateInsuranceSummary;

  // Additionally, guard direct DOM touches in updateSummary related to insurance
  if (typeof window.updateSummary === 'function' && !window.__summaryGuarded){
    window.__summaryGuarded = true;
    var origUpdateSummary = window.updateSummary;
    window.updateSummary = function(){
      try{
        return origUpdateSummary.apply(this, arguments);
      } catch(e){
        // If there is an error, try to at least build the chart
        try{
          if (typeof window.createSummaryChart === 'function') window.createSummaryChart();
        }catch(_){}
      }
    };
  }
})();
</script>

<script id="print-footer-relocator">
(function(){
  var footer = document.querySelector('.print-footer');
  var summaryPage = document.getElementById('page-zusammenfassung');
  if (!footer || !summaryPage || !footer.parentNode) return;

  var homeParent = footer.parentNode;
  var placeholder = document.createElement('div');
  placeholder.className = 'print-footer-placeholder';
  placeholder.style.display = 'none';
  homeParent.insertBefore(placeholder, footer.nextSibling);

  function moveFooterForPrint(){
    if (summaryPage.contains(footer)) return;
    footer.classList.add('print-footer-inline');
    summaryPage.appendChild(footer);
  }

  function restoreFooterAfterPrint(){
    if (footer.parentNode === homeParent) return;
    footer.classList.remove('print-footer-inline');
    if (placeholder.parentNode) {
      placeholder.parentNode.insertBefore(footer, placeholder);
    } else {
      homeParent.appendChild(footer);
    }
  }

  window.addEventListener('beforeprint', moveFooterForPrint);
  window.addEventListener('afterprint', restoreFooterAfterPrint);

  if (window.matchMedia) {
    var mediaQuery = window.matchMedia('print');
    if (typeof mediaQuery.addEventListener === 'function') {
      mediaQuery.addEventListener('change', function(event){
        event.matches ? moveFooterForPrint() : restoreFooterAfterPrint();
      });
    } else if (typeof mediaQuery.addListener === 'function') {
      mediaQuery.addListener(function(event){
        event.matches ? moveFooterForPrint() : restoreFooterAfterPrint();
      });
    }
  }
})();
</script>

</body>
</html>
